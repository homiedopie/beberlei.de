<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Setting up Development Machines with Puppet &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="../../../_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../../../_static/plugins.js"></script>
        <script src="../../../_static/main.js"></script>
        <link rel="next" title="Virtual Machines with Vagrant, Veewee and Puppet" href="../../05/31/virtual_machines_with_vagrant__veewee_and_puppet.html" /><link rel="prev" title="OOP Business Applications: Trying to escape the mess" href="../../08/11/oop_business_applications__trying_to_escape_the_mess.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script><script type="text/javascript" src="../../../_static/disqus.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="../../../index.html">Home</a></li>
						<li><a href="../../../pages/about.html">About</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="blog-post">
        <div class="section" id="setting-up-development-machines-with-puppet">
<h1>Setting up Development Machines with Puppet</h1>
<p>I wrote <a class="reference external" href="/2012/05/31/virtual_machines_with_vagrant__veewee_and_puppet.html">about Vagrant</a> last week and
mentioned to talk about <a class="reference external" href="http://puppetlabs.com/puppet/what-is-puppet/">Puppet</a> in the future. Before I will
dive into Puppet in combination with Vagrant I want to share my general
experiences with Puppet (beginners level, I just played with this today).</p>
<p>Puppet is a configuration management tool. It uses a declarative language to
describe how a system should look like. Upon invocation of puppet it attempts
to get the system from its current state into the desired state by installing
packages, executing programs/scripts and creating files/directories.</p>
<p>My laptop was still on Ubuntu 10.04 this morning, but for <a class="reference external" href="http://live.symfony.com">Symfony Live</a> I needed to upgrade to 12.04. This was necessary to
run a Virtualbox VM on my laptop that I built on my 12.04 desktop. Additionally
I really like the Unity desktop and wanted to get away from the Gnome that is
in 10.04.</p>
<p>After a backup and fresh installation of Ubuntu I realized how many things I
have to install to get this machine productive:</p>
<ul class="simple">
<li>LAMP stack + a bunch of other databases and services</li>
<li>Git, Svn, Hg, ..</li>
<li>Virtualbox + Vagrant</li>
<li>Vim with my Dot-Files, including Command-T which requires compilation,
and a bunch of development tools such as tree, ack-grep.</li>
<li>PHP Tools (PHPUnit, PHPCS, Xdebug, Xhprof)</li>
<li>Git with Author Information and global ignore file</li>
<li>A bunch of .bashrc initializations</li>
<li>Some open source projects I always have around (Doctrine, ...)</li>
<li>Setup automatic backup with my cloud storage provider (<a class="reference external" href="https://www.free-hidrive.com/">Strato Hidrive</a> - they support rsync)</li>
<li>and I probably forgot a bunch of tools just thinking about this today.</li>
</ul>
<p>I realized not only virtual machines, but also their hosts (my development
machines) could be automatically setup with Puppet.</p>
<p>So instead of saving my <span class="docutils literal"><span class="pre">.bash_history</span></span> to remember the steps I automated
them using Puppet. In Puppet you define Resources of several types, for example
Files, Packages or shell commands. You group these resources together in a
<span class="docutils literal"><span class="pre">.pp</span></span> file and then invoke <span class="docutils literal"><span class="pre">puppet</span> <span class="pre">apply</span> <span class="pre">&lt;file&gt;.pp</span></span>. You can install Puppet
via <span class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">puppet</span></span> on Ubuntu.</p>
<p>The idea is to define Puppet resources in a way that they are performed once and
then the system has this resource. This means you can run puppet as often as
you want and it will only activate the missing resources.</p>
<p>I separate the installation process into two puppet files, one that has to be
run with root <span class="docutils literal"><span class="pre">~/.puppet/devmachine-root.pp</span></span> and another one that has to be run with
my own user <span class="docutils literal"><span class="pre">~/.puppet/devmachine.pp</span></span>.</p>
<p>Because every dev-machine setup is unique, I will just show some
examples of my puppet file to get the message across:</p>
<div class="highlight-python"><div class="highlight"><pre># /home/benny/.puppet/devmachine.pp

# VIM Dot Files
vcsrepo { &#39;vim-dotfiles&#39;:
    path     =&gt; &quot;/home/$id/.vim&quot;,
    ensure   =&gt; present,
    provider =&gt; git,
    source   =&gt; &#39;https://...&#39;
}

file { &#39;vim-dotfiles-symlink&#39;:
    path   =&gt; &quot;/home/$id/.vimrc&quot;,
    ensure =&gt; link,
    target =&gt; &#39;.vim/vimrc&#39;,
    require =&gt; Vcsrepo[&#39;vim-dotfiles&#39;]
}

exec { &#39;vim-make-command-t&#39;:
    command =&gt; &#39;rake make&#39;,
    cwd     =&gt; &quot;/home/$id/.vim/bundle/Command-T&quot;,
    unless  =&gt; &quot;ls -aFlh /home/$id/.vim/bundle/Command-T|grep &#39;command-t.recipe&#39;&quot;,
    require =&gt; Vcsrepo[&#39;vim-dotfiles&#39;]
}
</pre></div>
</div>
<p>The three keywords <span class="docutils literal"><span class="pre">vcsrepo</span></span>, <span class="docutils literal"><span class="pre">file</span></span> and <span class="docutils literal"><span class="pre">exec</span></span> are called types. They
define what functionality should be executed by puppet. Vcsrepo is a custom
type that you can grab <a class="reference external" href="https://github.com/puppetlabs/puppetlabs-vcsrepo.git">from Github</a>.</p>
<ul class="simple">
<li>The first block uses Git to make sure that in my home directory the
<span class="docutils literal"><span class="pre">~/.vim</span></span> directory is a checkout of a given remote git repository.</li>
<li>The second file block makes sure that <span class="docutils literal"><span class="pre">~/.vimrc</span></span> points to <span class="docutils literal"><span class="pre">~/.vim/vimrc</span></span>
using a symlink.</li>
<li>The third block compiles the Command-T VIM plugin. Inside the
exec block you can see the unless condition. This is necessary to prevent the
command from being executed whenever <span class="docutils literal"><span class="pre">devmachine.pp</span></span> is executed with
puppet. The require makes sure this resource is only activated after the dotfiles
were installed.</li>
</ul>
<p>Another nice example is the configuration of Git:</p>
<div class="highlight-python"><div class="highlight"><pre># Configure Git
exec { &quot;git-author-name&quot;:
    command =&gt; &#39;git config --global user.name &quot;Benjamin Eberlei&quot;&#39;,
    unless =&gt; &quot;git config --global --get user.name|grep &#39;Benjamin Eberlei&#39;&quot;
}

exec { &quot;git-author-email&quot;:
    command =&gt; &#39;git config --global user.email &quot;kontakt@beberlei.de&quot;&#39;,
    unless =&gt; &quot;git config --global --get user.email|grep &#39;kontakt@beberlei.de&#39;&quot;
}

exec { &quot;git-global-ignore&quot;:
    command =&gt; &quot;git config --global core.excludesfile /home/$id/.gitignore&quot;,
    unless  =&gt; &#39;git config -l --global|grep excludesfile&#39;
}

file { &quot;git-global-ignorefile&quot;:
    path =&gt; &quot;/home/$id/.gitignore&quot;,
    ensure =&gt; present,
    content =&gt; &quot;*.swo\n*.swp\n&quot;
}
</pre></div>
</div>
<p>Here A bunch of commands is executed unless some option is already set. At last
the global .gitingore is filled with the patterns of Vim temporary files.</p>
<p>I also automated all the other steps listed above, but will spare you the
details. For the LAMP Stack + PHP I used <a class="reference external" href="https://github.com/dietervds/puppet-symfony2">this following Github repository</a> as an inspiration. It ships a
set of Puppet Modules. You can just put them into your <span class="docutils literal"><span class="pre">~/.puppet/modules</span></span>
folder and they are then available in any of your puppet files.</p>
<p>I can now reuse this on the different machines: desktop at home and at work and
my laptop. Whenever I install a new tool or change some configuration of my
system I can directly put this into puppet and keep the setup synchronized on
all the machines I work with.</p>
<p>You can find more detailed resources on the PuppetLabs website:</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.puppetlabs.com/learning/ral.html">Tutorial</a></li>
<li><a class="reference external" href="http://docs.puppetlabs.com/references/latest/type.html">Type Reference</a></li>
<li><a class="reference external" href="docs.puppetlabs.com/puppet_core_types_cheatsheet.pdf">Type Cheat Sheet</a></li>
</ul>
</div>


        
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2017, Benjamin Eberlei.</small>

						<script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>
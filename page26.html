<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Page 26 &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="next" title="Older" href="page27.html" /><link rel="prev" title="Newer" href="page25.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script><script type="text/javascript" src="_static/disqus.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="index.html">Home</a></li>
						<li><a href="pages/about.html">About</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="section">
            <h1><a href="2008/12/18/dependecy-injection-the-juicy-way.html">Dependency Injection the juicy way</a></h1>
<p>I have written on dependency injection before and <a class="reference external" href="http://www.whitewashing.de/blog/articles/83">came up with a
solution for PHP via interface
injection</a>. Thinking
about it twice I didn’t like it very much. Its too much overkill that
you have to implement all setter methods again and again.</p>
<p>Still dependency injection is the way to write good, testable and easily
exchanged and re-wired object graphs. I tried to do lots of dependency
injection via constructor lately and realized that it pollutes my
constructors when my object graph is too deep.</p>
<p>An example: When I setup my database connection in the bootstrap file
and encapsulate it in my model creation factory object, i have to insert
the model factory through the configuration into the dispatcher into the
different controllers and views to be accessible in the MVC pattern. The
model factory has to walk 3 nodes in the object graph without being used
at all in the “higher” steps. This creates very unnecessary
dependencies.</p>
<p>I came across <a class="reference external" href="http://misko.hevery.com/">Misko Hevery</a>‘s Blog, which
rocks. There are also some <a class="reference external" href="http://www.youtube.com/results?search_query=misko+hevery&amp;search_type=&amp;aq=f">great Google Tech Talks by
him</a>,
where he argues in favour of dependency injection and debunks singletons
as being evil (he does that on his blog too). From there I learnt about
<a class="reference external" href="http://code.google.com/p/google-guice/">Guice</a>, a dependency
injection framework for Java by Google.</p>
<p>What I like about Guice: Its easy to use and its immediately obvious to
someone without experience, why it works so good and you don’t have to
hand down objects deep down the object graph. I cloned the basic
functionality for PHP and an example would work as follows.</p>
<p>We first have to implement a <strong>module</strong>, which defines which concrete
implementation should be injected as a placeholder for which interface.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class ServiceModule implements Module{ public function configure(Binder $b) {  $b-&gt;bind("Service")-&gt;to("ConcreteService");  $b-&gt;bind("Add")-&gt;to("ConcreteAdd");  $b-&gt;bind("Sub")-&gt;to("ConcreteSub"); }}
</pre></div>
</div>
</div></blockquote>
<p>We can now use this module to instantiate an injector object:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>$injector = new Injector( new ServiceModule() );$service = $injector-&gt;getInstance("Service");
</pre></div>
</div>
</div></blockquote>
<p>Given that the constructor of <strong>ConcreteService</strong> would expect an Add
and a Sub object, the Injector would realize this and instantiate the
concrete implementations <strong>ConcreteAdd</strong> and <strong>ConcreteSub</strong> and inject
them into the constructor.</p>
<p>What makes this dependency injection so simple and great to use? You can
instantiate an injector everywhere in your code and just have to
configure it using the additional module implementation. This way you
don’t have to make sure that you pass down the dependency injection
container from the bootstrap into all nodes of the application. You can
also easily work with many frameworks and still be able to use
dependency injection without having to hack the whole core of the
framework.</p>
<p>My guice clone does more. It allows to pass down additional non-object
arguments into constructors, even for object dependencies. It offers a
<strong>Provider</strong> interface to be able to wrap adapters around your already
existing ServiceLocator or Registry objects. But its reflection
capabilities have to be extended to docblock comments, so that better
dependency detection is possible.</p>
<p>Because using dependency injection with only this little example I will
refrain from releasing the source code yet. I have to provide some
useful documentation for it to be of use to anyone.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on December 18, 2008
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2008/12/03/ezcomponents-view-handler-for-zend-pdf.html">ezComponents View Handler for Zend_Pdf</a></h1>
<p><a class="reference external" href="http://www.whitewashing.de/blog/article/93">My previous posting</a>
discussed different view handlers based on routing information. One
example was the PDF View which was implemented rather hackish through
overwriting the <strong>createResponseBody()</strong> function of <strong>ezcMvcView</strong>.
<a class="reference external" href="http://www.derickrethans.nl/">Derick</a> told me the way to go would be
writing my own PDF view handler. Since this is a rather lengthy topic I
created this new post that only discusses using
<a class="reference external" href="http://framework.zend.com/manual/en/zend.pdf.html">Zend_Pdf</a> as a
View Handler in the new <a class="reference external" href="http://www.ezcomponents.org">ezComponents
MvcTools</a>.</p>
<p>The code for the View Handler would look like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>abstract class myPdfViewHandler implements ezcMvcViewHandler
{
    /**
     * Contains the zone name
     *
     * @var string
     */
    protected $zoneName;

    /**
     * Contains the variables that will be available in the template.
     *
     * @var array(mixed)
     */
    protected $variables = array();

    /**
     * Pdf object to be rendered.
     *
     * @var Zend_Pdf
     */
    protected $pdf;

    /**
     * Creates a new view handler, where $zoneName is the name of the block and
     * $templateLocation the location of a view template.
     *
     * @var string $zoneName
     * @var string $templateLocation
     */
    public function __construct( $zoneName, $templateLocation = null )
    {
        $this-&gt;zoneName = $zoneName;
    }

    /**
     * Adds a variable to the template, which can then be used for rendering
     * the view.
     *
     * @param string $name
     * @param mixed $value
     */
    public function send( $name, $value )
    {
        $this-&gt;variables[$name] = $value;
    }

    /**
     * Processes the template with the variables added by the send() method.
     * The result of this action should be retrievable through the getResult() method.
     */
    public function process( $last )
    {
        // template method
    }

    /**
     * Returns the value of the property $name.
     *
     * @throws ezcBasePropertyNotFoundException if the property does not exist.
     * @param string $name
     * @ignore
     */
    public function __get( $name )
    {
        return $this-&gt;variables[$name];
    }

    /**
     * Returns true if the property $name is set, otherwise false.
     *
     * @param string $name
     * @return bool
     * @ignore
     */
    public function __isset( $name )
    {
        return array_key_exists( $name, $this-&gt;variables );
    }

    /**
     * Returns the name of the template, as set in the constructor.
     *
     * @return string
     */
    public function getName()
    {
        return $this-&gt;zoneName;
    }

    /**
     * Returns the result of the process() method.
     *
     * @return mixed
     */
    public function getResult()
    {
        if($this-&gt;pdf instanceof Zend_Pdf) {
            return $this-&gt;pdf-&gt;render();
        } else {
            throw new Exception("Could not render PDF.");
        }
    }
}
</pre></div>
</div>
</div></blockquote>
<p>Now you would implement a concrete PDF view handler by extending
myPdfViewHandler.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myConcretePdfViewHandler extends myPdfViewHandler {
    public function process( $last )
    {
        $pdf = new Zend_Pdf();
        // do concrete PDF drawing stuff here

        // save PDF here, will be rendered in getResult()
        $this-&gt;pdf = $pdf;
    }
}
</pre></div>
</div>
</div></blockquote>
<p>And your <strong>ezcMvcView</strong> implementation will make of <strong>createZones()</strong>
and look like the following:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myPdfView extends ezcMvcView {
    function createZones( $layout )
    {
        $zones = array();
        // A decision which concrete Pdf Handler should be used would be decided on here.
        $zones[] = new myConcretePdfViewHandler( 'concreteA' );
        return $zones;
    }
}
</pre></div>
</div>
</div></blockquote>
<p>There you go!</p>

            <div class="metadata">
        <p>
            <small>
                Posted on December 03, 2008
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2008/12/03/ezcomponents-2008-2-beta-mvc-separation-for-win.html">ezComponents 2008.2 Beta - Mvc separation for win</a></h1>
<p><a class="reference external" href="http://www.whitewashing.de/blog/articles/88">I have written</a> on the
<a class="reference external" href="http://ezcomponents.org">new ezComponents MvcTools</a> component before
already. Just yesterday the beta of this component was released with the
<a class="reference external" href="http://ezcomponents.org/resources/news/news-2008-12-01">general beta of the 2008.2
version</a> of
ezComponents. Several bugfixes and enhancements were included into the
MvcTools which make it a perfect component for any Mvc based
application.</p>
<p>I reviewed lots of the code myself and can only say i love the beauty of
the code. Its very simple but by default the most powerful mvc solution
in the PHP market. People working with unittests will like it very much,
since all the parts are perfectly separated from each other allowing to
test controllers, views, routers and filters in complete separation.</p>
<p>To show one very simple example howto benefit of the separation of view
and controllers. If we need a view in both html and pdf, this should
generally make no difference for the controller. We add two routes, one
for the pdf one for the html view that execute the same controller and
action:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myRouter extends ezcMvcRouter{ public function createRoutes() {  return array(   new ezcMvcRailsRoute( '/pdf', 'SomeController', 'index'),   new ezcMvcRailsRoute( '/', 'SomeController', index' ),  ); }}class SomeController extends ezcMvcController{ public function doIndex() {  $result = new ezcMvcResult();  $result-&gt;variables['items'] = Model::retrieveLotsOfItems();  return $result; }}
</pre></div>
</div>
</div></blockquote>
<p>Now howto decide between PDF and Html view? We use the createView method
of our dispatcher configuration, but we still only need the http
response writer, nothing more.</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myMvcConfiguration implements ezcMvcDispatcherConfiguration { [...] function createView( ezcMvcRoutingInformation $routeInfo, ezcMvcRequest $request, ezcMvcResult $result ) {  if(strstr($routeInfo-&gt;matchedRoute, "/pdf")) {   return new myHtmlView( $request, $result );  } else {   return new myPdfView( $request, $result );  } } function createResponseWriter( ezcMvcRoutingInformation $routeInfo, ezcMvcRequest $request, ezcMvcResult $result, ezcMvcResponse $response ) {  return new ezcMvcHttpResponseWriter( $response ); } [...]}
</pre></div>
</div>
</div></blockquote>
<p>Now both <strong>myHtmlView</strong> and <strong>myPdfView</strong> can create their
ezcMvcResponse objects that fill the response body depending on their
type. Please note that overwriting createResponseBody() in myPdfView is
a shortcut that circumvents me having to write a new PDF View Handler
(which would be the way to go).</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myHtmlView extends ezcMvcView { function createZones( $layout ) {  $zones = array();   $zones[] = new ezcMvcPhpViewHandler( 'content', '../templates/index.phtml' );  $zones[] = new ezcMvcPhpViewHandler( 'page_layout', '../templates/layout.phtml' );  return $zones; }}class myPdfView extends ezcMvcView { function createZones() {  // empty, abstract method that has to be defined. } function createResponseBody() {  // Set PDF Content-Type Response Header  $this-&gt;result-&gt;content-&gt;type = "application/pdf";   $pdf = new Zend_Pdf();  // do pdf stuff  return $pdf-&gt;render(); }}
</pre></div>
</div>
</div></blockquote>
<p>Now all the the logic that is potentially in the controller is completely
separated from the view handling that may depend on the routing
information not on the controller. And views can be tested separately
from the controller result. Testability is very high.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on December 03, 2008
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2008/12/04/rest-and-ajax-aware-controllers-in-ezcmvctools.html">REST and Ajax Aware controllers in ezcMvcTools</a></h1>
<p>There are essentially two major different ways to implement a restful
application using a web framework. You either implement a router that
routes to different controller actions based on the HTTP method used on
a requested resource. This is the fancy way, which sadly is not always
so practical because many browsers do not support sending more than GET
and POST requests. The other way would be to define suburls of a
resource such as <strong>/user/1/delete</strong> for the resource <strong>/user/1</strong> and
take GET a a request for deleting and POST for the confirmation of the
delete.</p>
<p>ezcMvcTools HTTP Request Parser and routing mechanisms currently offer
no real help to decide on this issues, but its easy to extend this
missing functionality. What we first add are simple checks of the
current http request method. We extend <strong>ezcMvcHttpRequestParser</strong> which
will return a derived <strong>ezcMvcRequest</strong> object that implements 7 new
methods: isPost(), isGet(), isDelete(), isPut(), isXmlHttpRequest(),
isMethod() and getMethod(). These methods can now be easily used on the
request object to determine which action will be undertaken:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myMvcRequest extends ezcMvcRequest{  public function isPost()  {    return $this-&gt;isMethod("POST");  }  public function isGet()  {    return $this-&gt;isMethod("GET");  }  public function isPut()  {    return $this-&gt;isMethod("PUT");  }  public function isDelete()  {    return $this-&gt;isMethod("DELETE");  }  public function isXmlHttpRequest()  {    if(isset($this-&gt;raw['HTTP_X_REQUESTED_WITH'])      &amp;&amp; strtolower($this-&gt;raw['HTTP_X_REQUESTED_WITH']) == "xmlhttprequest") {      return true;    }    return false;  }    public function getMethod()  {    if(isset($this-&gt;raw['REQUEST_METHOD']))      return strtolower($this-&gt;raw['REQUEST_METHOD']);    }    return false;  }  public function isMethod($method)  {    if(isset($this-&gt;raw['REQUEST_METHOD']) &amp;&amp;       $this-&gt;getMethod() == strtolower($method)) {      return true;    }    return false;  }}class myMvcHttpRequestParser extends ezcMvcHttpRequestParser{  /**   * Uses the data from the superglobals.   *   * @return ezcMvcRequest   */  public function createRequest()  {    $this-&gt;request = new myMvcRequest;    $this-&gt;processStandardHeaders();    $this-&gt;processAcceptHeaders();    $this-&gt;processUserAgentHeaders();    $this-&gt;processFiles();    $this-&gt;processAuthVars();    $this-&gt;request-&gt;raw = &amp;$_SERVER;    return $this-&gt;request;  }}
</pre></div>
</div>
</div></blockquote>
<p>This helps us to implement simple decision mechanisms in a single
controller action that takes both POST and GET requests. From the point
separation of concerns this is not a good design decision. We need
routes that can point to different controller actions based on their
request method, so that two requests <strong>GET /user/1/delete</strong> and <strong>POST
/user/1/delete</strong> lead to different methods, for example
<strong>userController::doDeleteDialog</strong> and <strong>userController::doDelete</strong>. We
will simply extend the <strong>ezcMvcRailsRoute</strong> to support decision based on
http request methods:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myMvcRestRoute extends ezcMvcRailsRoute{  protected $method;  public function __construct( $method, $pattern, $controllerClassName, $action = null, array $defaultValues = array() )  {    $this-&gt;method = $method;    parent::__construct($pattern, $controllerClassName, $action, $defaultValues);  }  public function matches( ezcMvcRequest $request )  {    if(strtolower($this-&gt;method) == strtolower($request-&gt;raw['REQUEST_METHOD'])) {      return parent::matches($request);    }    return null;  }}
</pre></div>
</div>
</div></blockquote>
<p>This very simple extension is independent of the advanced request parser
given above, so you could use it separately. In the light of our delete
user example, you would use the new router in the following way:</p>
<blockquote>
<div><div class="highlight-python"><div class="highlight"><pre>class myRouter extends ezcMvcRouter{  public function createRoutes()  {    return array(      new myMvcRestRoute( 'GET', '/users/:id/delete', 'UserController', 'deleteDialog' ),      new myMvcRestRoute( 'POST', '/users/:id/delete', 'UserController', 'delete' ),    );  }}
</pre></div>
</div>
</div></blockquote>
<p>We have now simple rest route support in our ezcMvcTools application.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on December 04, 2008
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2008/12/12/bad-news-jquery-ui-1-6-ships-without-spinner-and-autocomplete.html">Bad news: jQuery UI 1.6 ships without Spinner and AutoComplete</a></h1>
<p>The jQuery UI team <a class="reference external" href="http://blog.jquery.com/2008/12/11/whats-up-with-jquery-ui/">announced yesterday on its
blog</a> that
<a class="reference external" href="http://ui.jquery.com">jQuery UI 1.6</a> will not be shipped with
AutoComplete and Spinner Plugin support. No further delay, for the
original august 2008 estimated release, is wanted.</p>
<p>This brings about a problem on
<a class="reference external" href="http://framework.zend.com/manual/en/zendx.jquery.html">ZendX_JQuery</a>.
All view helpers and decorators that depend on AutoComplete and Spinner
Plugins can only be run with SVN trunk or 1.6 release candidates, which
have known bugs and problems.</p>
<p>I am adding a compatibility table to the ZendX jQuery manual today that
will make its way to the manual of the 1.7.2 release. This will
hopefully help and guide everyone to the correct dependencies.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on December 12, 2008
                
            </small>
        </p>
    </div>
        </div><div class="archive_link">
        <a href="archive.html">Archive</a>
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2017, Benjamin Eberlei.</small>

						<script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>
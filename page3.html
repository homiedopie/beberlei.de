<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Page 3 &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="next" title="Older" href="page4.html" /><link rel="prev" title="Newer" href="page2.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script><script type="text/javascript" src="_static/disqus.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="index.html">Home</a></li>
						<li><a href="pages/about.html">About</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="section">
            <h1><a href="2015/02/01/running_hhvm_webserver.html">Running HHVM with a Webserver</a></h1>
<p>I haven’t used <a class="reference external" href="http://hhvm.com">HHVM</a> yet because the use-case for the
alternative PHP runtime didn’t came up. Today I was wondering if our <a class="reference external" href="https://qafoolabs.com">Qafoo
Profiler</a> would run out of the box with HHVM using the
<a class="reference external" href="http://docs.hhvm.com/manual/en/ref.xhprof.php">builtin XHProf extension</a>
(Answer: It does).</p>
<p>For this experiment I wanted to run the wordpress blog of my wife on HHVM
locally. It turns out this is not very easy with an existing LAMP stack,
because mod-php5 and mod-fastcgi obviously compete for the execution of <cite>.php</cite>
files.</p>
<p>Quick googling didn’t turn up a solution (there probably is one, hints in the
comments are appreciated) and I didn’t want to install a Vagrant Box just for
this. So I decided to turn this into a sunday side project. Requirements: A
simple webserver that acts as proxy in front of HHVMs Fast-CGI. Think of it as
the “builtin webserver” that HHVM is missing.</p>
<p>This turns out to be really simple with Go, a language I use a lot for small
projects in the last months.</p>
<p>The code is <a class="reference external" href="https://github.com/beberlei/hhvm-serve/blob/master/hhvm-serve.go">very simple plumbing</a>
starting with a HTTP Server that accepts client requests, translates them to FastCGI
requests, sending them to HHVM and then parsing the FastCGI Response to turn it into a
HTTP Response.</p>
<p>As a PHP developer I am amazed how Go makes it easy to write this kind of
infrastructure tooling. I prefer PHP for everything web related, but as I tried
to explain in <a class="reference external" href="https://joind.in/event/view/2564">my talk at PHPBenelux last week</a>, Go is a fantastic language to write
small, self-contained infrastructure components (or Microservices if you want a
buzzword).</p>
<p>Back to playing with HHVM, if you want to give your application a try with HHVM
instead of ZendEngine PHP it boils down to <a class="reference external" href="https://github.com/facebook/hhvm/wiki/Prebuilt-Packages-for-HHVM">installing a prebuilt HHVM package</a> and then
using my <span class="docutils literal"><span class="pre">hhvm-serve</span></span> command:</p>
<div class="highlight-python"><div class="highlight"><pre>$ go get github.com/beberlei/hhvm-serve
$ hhvm-serve --document-root /var/www
Listening on http://localhost:8080
Document root is /var/www
Press Ctrl-C to quit.
</pre></div>
</div>
<p>The server passes all the necessary environment variables to HHVM so that
catch-all front-controller scripts such as Wordpress <span class="docutils literal"><span class="pre">index.php</span></span> or Symfony’s
<span class="docutils literal"><span class="pre">app.php</span></span> should just work.</p>
<p>If you don’t have a running Go Compiler setup this few lines should help you out on
Ubuntu:</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo apt-get install golang
$ GOPATH=~/go
$ mkdir -p ~/go/{src,bin,pkg}
$ PATH="$GOPATH/bin:$PATH"
</pre></div>
</div>
<p>You should put the <span class="docutils literal"><span class="pre">$GOPATH</span></span> and <span class="docutils literal"><span class="pre">$PATH</span></span> changes into your bashrc to make this
a permanent solution.</p>
<p>Starting to run HHVM, a Wordpress installation is a good first candidate to
check on, as I knew from HHVM team blog posts that Wordpress works. Using a
simple siege based benchmark I was able to trigger the JIT compiler and the
Profiler charts showed a nice performance boost minute after minute as HHVM
replaces dynamic PHP with optimized (assembler?) code.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on February 01, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2014/10/26/symfony_all_the_things_web.html">Symfony All The Things (Web)</a></h1>
<p>My <a class="reference external" href="http://www.whitewashing.de/2014/04/24/symfony_hello_world.html">Symfony Hello World post</a> introduced
the smallest possible example of a Symfony application. Using this in trainings
helps the participants understand of just how few parts a Symfony application
contains. Sure, there are lots of classes participating under the hood, but
I don’t care about the internals only about the public API.</p>
<p>We use microservice architectures for the <a class="reference external" href="http://info.bepado.de">bepado</a> and
<a class="reference external" href="https://qafoolabs.com">PHP Profiler</a> projects that Qafoo is working on at
the monent. For the different components a mix of Symfony Framework, Silex,
Symfony Components and our own Rest-Microframework (RMF) are used. This zoo of
different solutions sparked a recent discussion with <a class="reference external" href="https://twitter.com/manuelp">my colleague Manuel</a> about when we would want to use Symfony for a
web application.</p>
<p>We quickly agreed on: Always. I can’t speak for Manuel, but these are my
reasons for this decision:</p>
<ul>
<li><p class="first">I always want to use a technology that is based on Symfony HttpKernel,
because of the built-in caching, ESI and the <a class="reference external" href="http://stackphp.com/">Stack-PHP</a> project. I usually don’t need this at the beginning
of a project, but at some point the simplicity of extending the Kernel
through aggregation is incredible.</p>
<p>This leaves three solutions: Silex, Symfony Framework and Plain Components.</p>
</li>
<li><p class="first">I want a well documented and standardized solution. We are working with
a big team on bepado, often rotating team members for just some weeks or months.</p>
<p>We can count the hours lost for developers when they have to start learning a
new stack again. Knowing where to put routes, controllers, templates,
configuration et al is important to make time for the real tasks.</p>
<p>This leaves Symfony Framework and Silex. Everything built with the components
is always custom and therefore not documented well enough.</p>
</li>
<li><p class="first">I want a stable and extendable solution. Even when you just use Symfony
for a very small component you typically need to interface with the outside
world: OAuth, REST-API, HTTP Clients, Databases (SQL and NoSQL). <a class="reference external" href="http://friendsofsymfony.github.io/slides/there_is_a_bundle_for_that.html#1">There is
(always) a bundle for that</a> in Symfony.</p>
<p>Yes, Silex typically has a copy-cat Provider for their own DIC system, but
it is usually missing some configuration option or advanced use-case. In some
cases its just missing something as simple as a WebDebug Toolbar integration
that the Symfony Bundle has.</p>
<p>My experience with Silex has been that its always several steps behind
Symfony in terms of reusable functionality. One other downside with Silex in
my opinion is its missing support for DIC and Route caching. Once your Silex
application grows beyond its initial scope it starts to slow down.</p>
</li>
<li><p class="first">I want just one solution if its flexible enough.</p>
<p>It is great to have so many options, but that is also a curse. <a class="reference external" href="https://twitter.com/lsmith/status/526284891718443009">Lukas</a> points out he is picking
between Laravel, Silex or Symfony depending on the application use-case.</p>
<p>But the web technology stack is already complex enough in my opionion. I
rather have my developers learn and use different storage/queue or frontend
technologies than have them juggle between three frameworks. If my experience
with Symfony in the last 4 years taught me anything: Hands-on exposure
with a single framework for that long leads to impressive productivity.</p>
<p>And Symfony is flexible. The Dependency Injection based approach combined
with the very balanced decoupling through bundles allows you to cherry-pick
only what you need for every application: APIs, RAD, Large Teams. Everything
is possible.</p>
</li>
</ul>
<p>The analysis is obviously biased because of my previous exposure to the
framework. The productivity gains are possible with any framework as long as it
has a flourishing ecosystem. For anyone else this reasoning can end up to
choose Laravel, Silex or Zend Framework 2.</p>
<p>So what is the minimal Symfony distribution that would be a starting point.
Extending on the <a class="reference external" href="http://www.whitewashing.de/2014/04/24/symfony_hello_world.html">Symfony Hello World post</a>:</p>
<ol class="arabic simple">
<li>composer.json</li>
<li>index.php file</li>
<li>A minimal <span class="docutils literal"><span class="pre">AppKernel</span></span></li>
<li>A minimal config.yml file</li>
<li>routing files</li>
<li>A console script</li>
<li>A minimal application bundle</li>
</ol>
<p>You can find <a class="reference external" href="https://github.com/beberlei/symfony-minimal-distribution">all the code on Github</a>.</p>
<p>Start with the composer.json:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span>
    <span class="s2">"require"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"symfony/symfony"</span><span class="p">:</span> <span class="s2">"@stable"</span><span class="p">,</span>
        <span class="s2">"symfony/monolog-bundle"</span><span class="p">:</span> <span class="s2">"@stable"</span><span class="p">,</span>
        <span class="s2">"vlucas/phpdotenv"</span><span class="p">:</span> <span class="s2">"@stable"</span>
    <span class="p">},</span>
    <span class="s2">"autoload"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"psr-0"</span><span class="p">:</span> <span class="p">{</span> <span class="s2">"Acme"</span><span class="p">:</span> <span class="s2">"src/"</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The index.php:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// web/index.php</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">"/../vendor/autoload.php"</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">"/../app/AppKernel.php"</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nx">Dotenv</span><span class="o">::</span><span class="na">load</span><span class="p">(</span><span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">'/../'</span><span class="p">);</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>
<span class="nv">$kernel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SYMFONY_ENV'</span><span class="p">],</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SYMFONY_DEBUG'</span><span class="p">]);</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$kernel</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="nv">$response</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<span class="nv">$kernel</span><span class="o">-&gt;</span><span class="na">terminate</span><span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nv">$response</span><span class="p">);</span>
</pre></div>
</div>
<p>We are using the package <a class="reference external" href="https://github.com/vlucas/phpdotenv">vlucas/phpdotenv</a> to add <a class="reference external" href="http://12factor.net/">Twelve Factor app</a> compatibility, simplyfing configuration. This allows us to get rid of
the different front controller files based on environment. We need a file
called <span class="docutils literal"><span class="pre">.env</span></span> in our application root containing key-value pairs of
environment variables:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># .env</span>
<span class="n">SYMFONY_ENV</span><span class="o">=</span><span class="n">dev</span>
<span class="n">SYMFONY_DEBUG</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>Add this file to <span class="docutils literal"><span class="pre">.gitignore</span></span>. Your deployment to production needs
a mechanism to generate this file with production configuration.</p>
<p>Our minimal AppKernel looks like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// app/AppKernel.php</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Kernel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Config\Loader\LoaderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppKernel</span> <span class="k">extends</span> <span class="nx">Kernel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerBundles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$bundles</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">Symfony\Bundle\FrameworkBundle\FrameworkBundle</span><span class="p">(),</span>
            <span class="k">new</span> <span class="nx">Symfony\Bundle\TwigBundle\TwigBundle</span><span class="p">(),</span>
            <span class="k">new</span> <span class="nx">Symfony\Bundle\MonologBundle\MonologBundle</span><span class="p">(),</span>
            <span class="k">new</span> <span class="nx">Acme\HelloBundle\AcmeHelloBundle</span><span class="p">()</span>
        <span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEnvironment</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nv">$bundles</span><span class="p">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Symfony\Bundle\WebProfilerBundle\WebProfilerBundle</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$bundles</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerContainerConfiguration</span><span class="p">(</span><span class="nx">LoaderInterface</span> <span class="nv">$loader</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">'/config/config.yml'</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">in_array</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getEnvironment</span><span class="p">(),</span> <span class="k">array</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">,</span> <span class="s1">'test'</span><span class="p">)))</span> <span class="p">{</span>
            <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">'web_profiler'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'toolbar'</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
                <span class="p">));</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>It points to a configuration file <span class="docutils literal"><span class="pre">config.yml</span></span>. We don’t use
different configuration files per environment here because we don’t
need it. Instead we use the closure loader to enable the web debug
toolbar when we are in development environment.</p>
<p>Symfony configuration becomes much simpler if we don’t use the inheritance
and load everything from just a single file:</p>
<div class="highlight-python"><div class="highlight"><pre># app/config/config.yml
framework:
    secret: %secret%
    router:
        resource: "%kernel.root_dir%/config/routing_%kernel.environment%.yml"
        strict_requirements: %kernel.debug%
    templating:
        engines: ['twig']
    profiler:
        enabled: %kernel.debug%

monolog:
    handlers:
        main:
            type:         fingers_crossed
            action_level: %monolog_action_level%
            handler:      nested
        nested:
            type:  stream
            path:  "%kernel.logs_dir%/%kernel.environment%.log"
            level: debug
</pre></div>
</div>
<p>We can set the parameter values for <span class="docutils literal"><span class="pre">%secret%</span></span> and <span class="docutils literal"><span class="pre">%monolog_action_level%</span></span>
by adding new lines to <span class="docutils literal"><span class="pre">.env</span></span> file, making use of the excellent <a class="reference external" href="http://symfony.com/doc/current/cookbook/configuration/external_parameters.html">external
configuration parameter support</a>
in Symfony.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c1"># .env</span>
<span class="n">SYMFONY_ENV</span><span class="o">=</span><span class="n">dev</span>
<span class="n">SYMFONY_DEBUG</span><span class="o">=</span><span class="mi">1</span>
<span class="n">SYMFONY__SECRET</span><span class="o">=</span><span class="n">abcdefg</span>
<span class="n">SYMFONY__MONOLOG_ACTION_LEVEL</span><span class="o">=</span><span class="n">debug</span>
</pre></div>
</div>
<p>Now add a <span class="docutils literal"><span class="pre">routing_prod.yml</span></span> file with a hello world route:</p>
<div class="highlight-python"><div class="highlight"><pre># app/config/routing_prod.yml
hello_world:
    pattern: /hello/{name}
    defaults:
        _controller: "AcmeHelloBundle:Default:hello"
</pre></div>
</div>
<p>And because our routes are dependent on the environment in <span class="docutils literal"><span class="pre">config.yml</span></span> also a
<span class="docutils literal"><span class="pre">routing_dev.yml</span></span> containing the WebDebug toolbar and profiler routes:</p>
<div class="highlight-python"><div class="highlight"><pre># app/config/routing_dev.yml
_wdt:
    resource: "@WebProfilerBundle/Resources/config/routing/wdt.xml"
    prefix:   /_wdt

_profiler:
    resource: "@WebProfilerBundle/Resources/config/routing/profiler.xml"
    prefix:   /_profiler

_main:
    resource: routing_prod.yml
</pre></div>
</div>
<p>We now need a bundle <span class="docutils literal"><span class="pre">AcmeHelloBundle</span></span> that is referenced
in routing.yml and in the AppKernel. When we follow Fabiens best practice
about adding services, routes and templates into the <span class="docutils literal"><span class="pre">app/config</span></span> and
<span class="docutils literal"><span class="pre">app/Resources/views</span></span> folders adding a bundle just requires the bundle class:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/Acme/HelloBundle/AcmeHelloBundle.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Bundle\Bundle</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AcmeHelloBundle</span> <span class="k">extends</span> <span class="nx">Bundle</span>
<span class="p">{</span>
<span class="p">}</span>
</pre></div>
</div>
<p>And the controller that renders our Hello World:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/Acme/HelloBundle/Controller/DefaultController.php</span>

<span class="k">namespace</span> <span class="nx">Acme\HelloBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DefaultController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">(</span><span class="nv">$name</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span>
            <span class="s1">'AcmeHelloBundle:Default:hello.html.twig'</span><span class="p">,</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nv">$name</span><span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now we only put a template into <span class="docutils literal"><span class="pre">app/Resources</span></span>:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="c">{# app/Resources/AcmeHelloBundle/views/Default/hello.html.twig #}</span><span class="x"/>
<span class="x">Hello </span><span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span><span class="x">!</span>
</pre></div>
</div>
<p>As a last requirement we need a console script to manage our Symfony
application. We reuse the vlucas/phpdotenv integration here to
load all the required environment variables:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">#!/usr/bin/env php</span>
<span class="cp">&lt;?php</span>
<span class="c1">// app/console</span>

<span class="nb">set_time_limit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/../vendor/autoload.php'</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">'/AppKernel.php'</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Console\Application</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Console\Input\ArgvInput</span><span class="p">;</span>

<span class="nx">Dotenv</span><span class="o">::</span><span class="na">load</span><span class="p">(</span><span class="nx">__DIR__</span> <span class="o">.</span> <span class="s1">'/../'</span><span class="p">);</span>

<span class="nv">$input</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArgvInput</span><span class="p">();</span>
<span class="nv">$kernel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SYMFONY_ENV'</span><span class="p">],</span> <span class="p">(</span><span class="nx">bool</span><span class="p">)</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'SYMFONY_DEBUG'</span><span class="p">]);</span>
<span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">(</span><span class="nv">$kernel</span><span class="p">);</span>
<span class="nv">$application</span><span class="o">-&gt;</span><span class="na">run</span><span class="p">(</span><span class="nv">$input</span><span class="p">);</span>
</pre></div>
</div>
<p>Voila. The minimal Symfony distribution is done.</p>
<p>Start the php built in webserver to take a look</p>
<div class="highlight-python"><div class="highlight"><pre>$ php -S localhost:8080 web/index.php
</pre></div>
</div>
<p>I personally like this simplicity of that, the only thing that annoys me are
the two routing files that I need to conditionally load the web profiler routes
and the closure loader for the web_profiler extension. I suppose the nicer
approach would be a compiler pass that does all the magic behind the scenes.</p>
<p>From this minimal distribution you can:</p>
<ol class="arabic simple">
<li>Add new services to <span class="docutils literal"><span class="pre">app/config/config.yml</span></span>.</li>
<li>Add new routes to <span class="docutils literal"><span class="pre">app/config/routing_prod.yml</span></span>.</li>
<li>Add controllers into new bundles and templates into <span class="docutils literal"><span class="pre">app/Resources</span></span>.</li>
<li>Add third party bundles or Stack-PHP implementations when you need existing, reusable functionality such
as OAuth, Databases etc.</li>
<li>Add configuration variables to <span class="docutils literal"><span class="pre">.env</span></span> file instead of using the
<span class="docutils literal"><span class="pre">app/config/parameters.yml</span></span> approach.</li>
</ol>
<p>This scales well, because at every point you can move towards abstracting
bundles and configuration more using Symfony’s built in functionality.
No matter what type of application you build, it is always based on Symfony
and the building blocks are always the same.</p>
<p>I suggest to combine this minimal Symfony with the <a class="reference external" href="https://github.com/QafooLabs/QafooLabsNoFrameworkBundle">QafooLabsFrameworkExtraBundle</a> that I <a class="reference external" href="http://www.whitewashing.de/2014/10/14/lightweight_symfony2_controllers.html">blogged
about two weeks ago</a>.
Not only will the Symfony be lightweight also your controllers. You can built
anything on top this foundation from simple CRUD, APIs, hexagonal- or CQRS-architextures.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on October 26, 2014
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2014/10/14/lightweight_symfony2_controllers.html">Lightweight Symfony2 Controllers</a></h1>
<p>For quite some time I have been experimenting how to best implement Symfony 2
controllers to avoid depending on the framework. I have discussed many of these
insights here in my blog.</p>
<p>There are three reasons for my quest:</p>
<p>Simplicity: Solutions to avoid the dependencies between framework
and your model typically introduce layers of abstraction that produce
complexity. Service layers, CQRS and various design patterns are useful
tools, but developing every application with this kind of abstraction screams
over-engineering.</p>
<p>While the Domain-Driven Design slogan is “Tackling complexity in software”,
there are many abstractions out there that can better be described as “Causing
complexity in software”. I have written some of them myself.</p>
<p>Testability: There is a mantra “Don’t unit-test your controllers” that arose
because controllers in most frameworks are just not testable. They have many
dependencies on other framework classes and cannot be created in a test
environment. This lead many teams to use slow and brittle integration tests instead.</p>
<p>But what if controllers were testable because they don’t depend on the
framework anymore. We could avoid testing all the many layers that we
have removed for the sake of simplicity and also reduce the number of
slow integration tests.</p>
<p>Refactorability: I found that when using service layer or CQRS, there is a
tendency to use them for every use-case, because the abstraction is in place.
Any use-case that is not written with those patterns is coupled against the
framework again. Both development approaches are very different and refactoring
from one to the other typically requires a rewrite.</p>
<p>A good solution should allow refactoring from a lightweight controller to a
service layer with a small number of extract method and extract class
refactorings.</p>
<p>While working on <a class="reference external" href="https://tideways.io/">Tideways Profiler</a> product I
went to work on a solution that allowed for Simplicity, Testability and
Refactorability and came up with the
<a class="reference external" href="https://github.com/qafoolabs/QafooLabsNoFrameworkBundle">NoFrameworkBundle</a>.</p>
<p>The design of the bundle is careful to extend Symfony in a way that is easy
for Symfony developers to understand. To achieve this it heavily extends
upon the FrameworkExtraBundle that is bundled with Symfony.</p>
<p>The design goals are:</p>
<ul class="simple">
<li>Favour Controller as Services to decouple them from the Framework.</li>
<li>Replace every functionality of the Symfony Base controller in a way
that does not require injecting a service into your controller.</li>
<li>Never fetch state from services and inject it into the controller instead.</li>
<li>Avoid annotations</li>
</ul>
<p>The concepts are best explained by showing an example:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">QafooLabs\MVC\TokenContext</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$taskRepository</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">TaskRepository</span> <span class="nv">$taskRepository</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskRepository</span> <span class="o">=</span> <span class="nv">$taskRepository</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nx">TokenContext</span> <span class="nv">$context</span><span class="p">,</span> <span class="nx">Task</span> <span class="nv">$task</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$context</span><span class="o">-&gt;</span><span class="na">isGranted</span><span class="p">(</span><span class="s1">'ROLE_TASK'</span><span class="p">,</span> <span class="nv">$task</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">AccessDeniedHttpException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">'task'</span> <span class="o">=&gt;</span> <span class="nv">$task</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This example demos the following features:</p>
<ul>
<li><p class="first">The <span class="docutils literal"><span class="pre">TokenContext</span></span> wraps access to the <span class="docutils literal"><span class="pre">security.context</span></span> service and is
used for checking access permissions and retrieving the current User object.
It is passed to the controller with the help of ParamConverter feature.</p>
<p><span class="docutils literal"><span class="pre">TokenContext</span></span> here is just an interface and for testing you can
use a very simple mock implementation to pass an authenticated user to your
controller.</p>
</li>
<li><p class="first">View parameters are returned from the controller as an array, however
without requiring the <span class="docutils literal"><span class="pre">@Template</span></span> annotation of the
SensioFrameworkExtraBundle.</p>
</li>
</ul>
<p>The next example demontrates the abstraction for form requests that help writing very
concise form code:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">QafooLabs\MVC\TokenContext</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">QafooLabs\MVC\RedirectRouteResponse</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">QafooLabs\MVC\FormRequest</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">TaskController</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="nv">$taskRepository</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">newAction</span><span class="p">(</span><span class="nx">FormRequest</span> <span class="nv">$formRequest</span><span class="p">,</span> <span class="nx">TokenContext</span> <span class="nv">$context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$task</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Task</span><span class="p">(</span><span class="nv">$context</span><span class="o">-&gt;</span><span class="na">getUser</span><span class="p">());</span>

        <span class="k">if</span> <span class="p">(</span><span class="nv">$formRequest</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="k">new</span> <span class="nx">TaskType</span><span class="p">(),</span> <span class="nv">$task</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">taskRepository</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">(</span><span class="nv">$task</span><span class="p">);</span>

            <span class="k">return</span> <span class="k">new</span> <span class="nx">RedirectRouteResponse</span><span class="p">(</span><span class="s1">'Task.show'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">'id'</span> <span class="o">=&gt;</span> <span class="nv">$task</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()));</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">array</span><span class="p">(</span><span class="s1">'form'</span> <span class="o">=&gt;</span> <span class="nv">$formRequest</span><span class="o">-&gt;</span><span class="na">createFormView</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<ul>
<li><p class="first">The <span class="docutils literal"><span class="pre">RedirectRouteResponse</span></span> is used to redirect to a route without
a need for the <span class="docutils literal"><span class="pre">router</span></span> service.</p>
</li>
<li><p class="first">Usage of the <span class="docutils literal"><span class="pre">FormRequest</span></span> object that is a wrapper around FormFactory and
Request object. It is passed by using a ParamConverter. The method
<span class="docutils literal"><span class="pre">$formRequest-&gt;handle</span></span> combines binding the request and checking for valid
data.</p>
<p>Again there is a set of mock form request that allow you to simulate valid or
invalid form requests for testing.</p>
</li>
</ul>
<p>Writing controllers in this way addresses my requirements Simplicity,
Testability and Refactorability. For simple CRUD controllers they only ever
need access to a repository service. If one of your controllers grows too big,
just refactor out its business logic into services and inject them.</p>
<p>Check out the <a class="reference external" href="https://github.com/QafooLabs/QafooLabsNoFrameworkBundle">repository on Github</a> for some more
features that we are using in <a class="reference external" href="https://tideways.io/">Tideways</a>.</p>
<p>Update 1: Renamed <span class="docutils literal"><span class="pre">FrameworkContext</span></span> to <span class="docutils literal"><span class="pre">TokenContext</span></span> as done
in new 2.0 version of the bundle.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on October 14, 2014
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2014/08/11/spotting_featureenvy_and_refactoring.html">Spotting Feature Envy and Refactoring</a></h1>
<p>I was following <a class="reference external" href="http://twitter.com/rinkkasatiainen">Aki’s</a> on the
<a class="reference external" href="https://www.softwerkskammer.org/activities/socrates-2014">SoCraTes2014</a>
conference last week about Legacy Code and Refactoring. In the session a piece
of real-world code was shown that contained one of most common code smells in
LegacyCode: Feature Envy.</p>
<p>Martin Fowler describes this smell as “a method that seems more interested in
a class other than the one it is in. The most common focus of the envy is the
data.”</p>
<p>This code smell causes two very similar problems in a code base:</p>
<ul class="simple">
<li>Duplication of rules related to their data throughout the code base.</li>
<li>Spreading domain concepts throughout the whole code-base.</li>
</ul>
<p>A simple example can show this problem with <span class="docutils literal"><span class="pre">DateTime</span></span> is wide-spread in many
PHP projects. We often see code such as the following computation to
create a range of dates for a reporting function:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">function</span> <span class="nf">calculateReport</span><span class="p">(</span><span class="nx">DateTime</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$days</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="nv">$days</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nv">$endDate</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$start</span><span class="p">;</span>
    <span class="nv">$endDate</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span><span class="s1">'+'</span> <span class="o">.</span> <span class="nv">$days</span> <span class="o">.</span> <span class="s1">' day'</span><span class="p">);</span>

    <span class="c1">// calculation code here</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This is a really simple example for Feature Envy: The computation and
validation of creating an end date some days in the future of a start date
can easily be duplicated throughout the whole code base and implements
business rules that belong to the class <span class="docutils literal"><span class="pre">DateTime</span></span> itself:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">DateTime</span>
<span class="p">{</span>
    <span class="c1">// ... other methods</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">getDateDaysInFuture</span><span class="p">(</span><span class="nv">$days</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$days</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">InvalidArgumentException</span><span class="p">(</span><span class="nv">$days</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nv">$endDate</span> <span class="o">=</span> <span class="k">clone</span> <span class="nv">$this</span><span class="p">;</span>
        <span class="nv">$endDate</span><span class="o">-&gt;</span><span class="na">modify</span><span class="p">(</span><span class="s1">'+'</span> <span class="o">.</span> <span class="nv">$days</span> <span class="o">.</span> <span class="s1">' day'</span><span class="p">);</span>

        <span class="k">return</span> <span class="nv">$endDate</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">calculateReport</span><span class="p">(</span><span class="nx">DateTime</span> <span class="nv">$start</span><span class="p">,</span> <span class="nv">$days</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nv">$endDate</span> <span class="o">=</span> <span class="nv">$start</span><span class="o">-&gt;</span><span class="na">getDateDaysInFuture</span><span class="p">(</span><span class="nv">$days</span><span class="p">);</span>

    <span class="c1">// calculation code here.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>(Note: You cant extend the builtin DateTime this way and need to subclass).</p>
<p>This is a great way to improve your code base massively and achieve what
Object-Oriented and Domain-Driven Design is about: Modelling concepts of the
domain by encapsulating data and behavior.</p>
<p>Learning to spot this kind of Feature Envy is a very good way to incrementally
improve your legacy code base towards better models. I find it very interesting
that the focus on fixing technical code-smells duplication and feature envy
actually leads to a better domain model. As a side effect it massively
deemphasizes DDD building blocks like Entity or Value Object, which in my
opinion are a big cause for confusion. Testability increases as well, because
data objects with behavior are much simpler to setup for testing.</p>
<p>That is why I recommend learning about Feature Envy. For me it is a very simple
approach to find improvements.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on August 11, 2014
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2014/04/24/symfony_hello_world.html">Symfony2: A Simple Hello World</a></h1>
<p>Reading <a class="reference external" href="http://programming.oreilly.com/2014/04/simplifying-django.html">Simplyfing Django</a>
I was reminded of how we organize the <a class="reference external" href="http://qafoo.com/services/training/topics/symfony2.html">Symfony2 Training at Qafoo</a>
to start with a very simple “Hello World” example.</p>
<p>The Symfony2 Standard Edition already contains a huge burden of concepts,
assumptions and conventions that can be confusing for a beginner.</p>
<ul class="simple">
<li>YAML</li>
<li>Twig</li>
<li>Environments and Dependency Injection Container</li>
<li>Various weird and magic syntaxes for bundles, <span class="docutils literal"><span class="pre">_controller</span></span> and template names</li>
<li>Various files to open and poke around in</li>
<li>Composer</li>
<li>Maybe even Doctrine</li>
</ul>
<p>As a trainer it is very hard to explain all this at the same time.
It makes a lot of sense to avoid as many of them as possible.</p>
<p>That is why the Standard Edition is not the best way to start teaching Symfony,
but one should actually consider a much lighter version of the framework and
then gradually add more and more features until you end up with the standard
edition.</p>
<p>Fabien discussed the simplification of the Symfony Standard Edition from
another angle before, considering the minimum necessary code to use when
reproducing bugs in his blog post <a class="reference external" href="http://fabien.potencier.org/article/70/packing-a-symfony-full-stack-framework-application-in-one-file-bootstrapping">“Packing a Symfony Full-Stack Application in
one file”</a>.</p>
<p>This blog post is about a truely minimal Symfony edition to start learning
about the framework.  The first thing I like to show is a really simple Hello
World controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Acme\TrainingBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloController</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="s1">'Hello World!'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>What is the necessary framework glue code to support this Hello World? Lets start
from the index file <cite>web/index.php</cite>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">"/../vendor/autoload.php"</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="s2">"/../app/AppKernel.php"</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>
<span class="nv">$kernel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="s1">'dev'</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
<span class="nv">$kernel</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$request</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>We are using Composer here and the <span class="docutils literal"><span class="pre">AppKernel</span></span> class, lets take a peak
at them:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">{</span>
<span class="x">    "require": {</span>
<span class="x">        "symfony/symfony": "@stable"</span>
<span class="x">    },</span>
<span class="x">    "autoload": {</span>
<span class="x">        "psr-0": { "Acme": "src/" }</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<p>The <cite>composer.json</cite> file installs the latest stable Symfony release and
adds autoloading for classes starting with <span class="docutils literal"><span class="pre">Acme</span></span> in the folder <cite>src</cite>.</p>
<p>We need to define a Kernel for our application in <cite>app/AppKernel.php</cite>
and the minimal version of this looks like:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpKernel\Kernel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\Config\Loader\LoaderInterface</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">AppKernel</span> <span class="k">extends</span> <span class="nx">Kernel</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerBundles</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">new</span> <span class="nx">Symfony\Bundle\FrameworkBundle\FrameworkBundle</span><span class="p">(),</span>
            <span class="k">new</span> <span class="nx">Symfony\Bundle\TwigBundle\TwigBundle</span><span class="p">(),</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">registerContainerConfiguration</span><span class="p">(</span><span class="nx">LoaderInterface</span> <span class="nv">$loader</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">load</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nv">$container</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$container</span><span class="o">-&gt;</span><span class="na">loadFromExtension</span><span class="p">(</span><span class="s1">'framework'</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'secret'</span> <span class="o">=&gt;</span> <span class="s1">'some secret here'</span><span class="p">,</span>
                <span class="s1">'router'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                    <span class="s1">'resource'</span> <span class="o">=&gt;</span> <span class="s1">'%kernel.root_dir%/config/routing.yml'</span>
                <span class="p">),</span>
                <span class="s1">'templating'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'engines'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span><span class="s1">'twig'</span><span class="p">))</span>
            <span class="p">));</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In trainings we are starting with a single <span class="docutils literal"><span class="pre">config.yml</span></span> file but that is
technically not necessary by using the <span class="docutils literal"><span class="pre">ClosureLoader</span></span>. The routing
component has no such closure loader, so its not possible to avoid
YAML in the first minutes of Symfony2 exposure and we reference
the <cite>app/config/routing.yml</cite>:</p>
<div class="highlight-yaml"><div class="highlight"><pre>hello:
  pattern: /
  defaults:
    _controller: "Acme\TrainingBundle\Controller\HelloController::helloAction"
</pre></div>
</div>
<p>Did you know that you can specify controllers in Symfony by using the static callback
syntax? It has disadvantages when considering bundle inheritance, but why
bother a beginner with this feature and confuse him with the convention of
<span class="docutils literal"><span class="pre">"AcmeTrainingBundle:Hello:hello"</span></span>.</p>
<p>There are still lots of trip wires to stumble upon in this simple piece of <span class="docutils literal"><span class="pre">routing.yml</span></span>:</p>
<ul class="simple">
<li>Tabs are not allowed in YAML, in every training at least one person gets
bitten by that.</li>
<li>2 vs 4 spaces ambiguity.</li>
<li>What is this magic <span class="docutils literal"><span class="pre">_controller</span></span> key?</li>
<li>I carefully avoid the <span class="docutils literal"><span class="pre">{}</span></span> inline syntax of YAML here as well as it
introduces yet another ambiguity.</li>
</ul>
<p>Run this application with the build in webserver:</p>
<div class="highlight-python"><div class="highlight"><pre>$ php -S localhost:8000 web/index.php
</pre></div>
</div>
<p>Hello World!</p>
<p>The next step for a beginner is his first twig template to print the Hello
World. To avoid another confusing convention at the beginning, the <span class="docutils literal"><span class="pre">"AcmeTrainingBundle:Hello:hello.html.twig"</span></span>
template syntax, you can make use of the <cite>app/Resources/views/</cite> folder
that is automatically registered in the Twig Bundle. Just create
a template <cite>app/Resources/views/hello.html.twig</cite> and change the controller:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Acme\TrainingBundle\Controller</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">HelloController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">helloAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">'hello.html.twig'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The total number of files is 5 (6 with template) for this example. Note that we
haven’t actually created a bundle for <span class="docutils literal"><span class="pre">AcmeWorkshopBundle</span></span> yet, because with
the static syntax we don’t need it.</p>
<p>This is a very good starting point to start exploring more features of Symfony
and gradually add the required configuration and files for this.</p>

            <div class="metadata">
        <p>
            <small>
                Posted on April 24, 2014
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="archive_link">
        <a href="archive.html">Archive</a>
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2017, Benjamin Eberlei.</small>

						<script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>
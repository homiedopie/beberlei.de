<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Page 3 &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="search" title="Search" href="search.html" /><link rel="next" title="Older" href="page4.html" /><link rel="prev" title="Newer" href="page2.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="index.html">Home</a></li>
						<li><a href="pages/about.html">About</a></li>
						<li><a href="pages/imprint.html">Imprint</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="section">
            <h1><a href="2015/06/12/the_containertest.html">The ContainerTest</a></h1>
<p>This is a short post before the weekend about testing in applications with
dependency injection container (DIC). This solution helps me with a problem
that I occasionally trip over in environments with large amounts of services
connected through a DIC.</p>
<p>The problem is forgetting to adjust the DIC configuration when you add a new or
remove a dependency to a service. This can easily slip through into production
if you rely on your functional- and unit-tests to catch the problem.</p>
<p>I can avoid this problem by adding a functional test in my application that
instantiate all the various services and checks if they are created correctly.
The first time I saw this pattern was during development of some of the early
Symfony2 bundles, most notably DoctrineBundle.</p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Acme</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">ContainerTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SymfonySetup</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">dataServices</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">array</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'AcmeDemoBundle.FooService'</span><span class="p">,</span> <span class="s1">'Acme\DemoBundle\Service\FooService'</span><span class="p">),</span>
            <span class="k">array</span><span class="p">(</span><span class="s1">'AcmeDemoBundle.BarController'</span><span class="p">,</span> <span class="s1">'Acme\DemoBundle\Controller\BarController'</span><span class="p">),</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @test</span>
<span class="sd">     * @dataProvider dataServices</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">it_creates_service</span><span class="p">(</span><span class="nv">$id</span><span class="p">,</span> <span class="nv">$class</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$service</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertInstanceOf</span><span class="p">(</span><span class="nv">$class</span><span class="p">,</span> <span class="nv">$service</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Whenever you create or modify a service check the ContainerTest if its already
guarded by a test. Add a test if necesary and then make the change. It’s as
easy as that.</p>
<p>The <span class="docutils literal"><span class="pre">SymfonySetup</span></span> trait provides access to the Symfony DIC using
<span class="docutils literal"><span class="pre">getContainer()</span></span> as you can see in the test method. See <a class="reference external" href="http://www.whitewashing.de/2015/02/14/phpunit_before_annotations_and_traits_for_code_reuse.html">my blog post</a>
on traits in tests for more information.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/symfony.html">Symfony</a>
                 / 
                <a href="tags/testing.html">Testing</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on June 12, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2015/04/11/monolithic_repositories_with_php_and_composer.html">Monolithic Repositories with PHP and Composer</a></h1>
<blockquote>
<div>tl;dr Monolithic repositories can bring a lot of benefits. I prototyped
<a class="reference external" href="https://github.com/beberlei/fiddler">Fiddler</a> that complements Composer
to add dependency management for monolithic repositories to PHP.</div></blockquote>
<p>Thanks to <a class="reference external" href="https://twitter.com/iam_asm89">Alexander</a> for discussing this
topic with me as well as reviewing the draft of this post.</p>
<p>As Git and Composer are more ubiquitous in open-source projects and within
companies, monolithic repositories containing multiple projects have become a
bit of a bad practice. This is a similar trend to how monolithic applications
are out of fashion and the recent focus on microservices and Docker.</p>
<p>Composer has made it possible to create many small packages and distribute them
easily through Packagist. This has massively improved the PHP ecosystem by
increasing re-usability and sharing.</p>
<p>But it is important to consider package distribution and development seperate
from each other. The current progress in package manager tooling comes at a
cost for version control productivity, because Composer, NPM, Bower force you
to have exactly one repository for one package to benefit from the
reusability/distribution.</p>
<p>This blog post compares monolithic repositories with one repository per package
approach. It focuses on internal projects and repositories in organizations and
companies. I will discuss open source projects in a follow-up post.</p>
<div class="section" id="workflow-at-facebook-google-twitter">
<h2>Workflow at Facebook, Google, Twitter</h2>
<p>The move towards smaller repositories is called into question by three extremely
productive organizations that work at incredible scale.</p>
<ul class="simple">
<li>Facebook <a class="reference external" href="https://developers.facebooklive.com/videos/561/big-code-developer-infrastructure-at-facebook-s-scale">mentioned in their talk “Big Code: Developer Infrastructure at
Facebook’s Scale”</a>
that they are going to merge their three big code repositories Server, iOS
and Android into a single big repository over the course of 2015.</li>
<li>Google open-sourced <a class="reference external" href="http://bazel.io">Bazel</a>, the build tool behind a huge
chunk of their codebase managed in a single Perforce repository with over 20 million
commits (<a class="reference external" href="http://www.perforce.com/sites/default/files/still-all-one-server-perforce-scale-google-wp.pdf">Reference</a>).</li>
<li>Twitter, Foursquare and Square are working on their clone of Google’s Bazel
build system called <a class="reference external" href="https://pantsbuild.github.io/">Pants</a>. It is also
designed for monolithic repositories.</li>
</ul>
<p>All three companies cite huge developer productivity benefits,
code-reusability, large-scale refactorings and development at scale for
choosing this approach. The Facebook talk even mentions how all their
development infrastructure efforts focus on keeping this workflow because of
the benefits it brings.</p>
</div>
<div class="section" id="downsides-of-having-many-repositories">
<h2>Downsides of having many Repositories</h2>
<p>In contrast working with ever smaller repositories can be a huge burden for
developer mental models: I have seen this in open-source projects such as
Doctrine and several customer projects:</p>
<ol class="arabic simple">
<li>Cross repository changes require certain pull-requests on Github/Gitlab to
be merged in order or in combination yet the tools don’t provide visibility
into these dependencies. They are purely informal, leading to high error
rates.</li>
<li>Version pinning through NPM and Composer package managers is great for
managing third party dependencies as long its not too many of them and they
don’t change too often. For internal dependencies its a lot of work to
update dependencies between repositories all the time. Time gets lost by
developers that don’t have the correct dependencies or because of mistakes
in the merge process.</li>
<li>Changing code in core libraries can break dependencies without the developer
even realizing this because tests don’t run together. This introduces a
longer feedback cycle between code that depends on each other, with all the
downsides.</li>
</ol>
<p>One important remark about monolithic repositories: It does not automatically
lead to a monolithic code-base. Especially Symfony2 and ZF2 are a very
good example of how you can build individual components with a clean dependency
graph in a single big repository.</p>
<p>At <a class="reference external" href="http://qafoo.com">Qafoo</a> we have always preferred monolithic project
repositories containing several components over many small independent ones. We
advised many customers to choose this approach except in some special cases
where going small was economically more efficient.</p>
</div>
<div class="section" id="benefits-of-monolithic-repositories">
<h2>Benefits of Monolithic Repositories</h2>
<p>Even if you are not at the scale of Facebook or Google, a single repository
still provides the mentioned benefits:</p>
<ul class="simple">
<li>Adjusting to constant change by factoring out libraries, merging libraries
and introducing new dependencies for multiple projects is much easier when
done in a single, atomic VCS commit.</li>
<li>Discoverability of code is much higher, if you have all the code in a single
place. Github and Gitlab don’t offer powerful tools like find, grep, sed over
more than one repository. Hunting down dependencies, in specific versions can
cost alot of time.</li>
<li>Reusability increases as it is much easier to just use code from the same
repository than from another repository. Composer and NPM simplify combining
repositories at specific versions, however one problem is actually knowing
that the code exists in the first place.</li>
<li>From an operational perspective it is much easier to get a new developer
up to speed setting up projects from a single repository. Just practically
its easier to add his public key to only one Team/Repository/Directory than
to hundreds. On top of that setting up many small repositories and
familiarizing with each of them costs a lot of time.</li>
</ul>
<p>This is why I have been struggling with how Packagist and Satis force the move
to smaller repositories through the technical constraint “one repository equals
one composer.json file”. For reusable open source projects this is perfectly
fine, but for company projects I have seen it hurt developer productivity more
often than is acceptable.</p>
</div>
<div class="section" id="introducing-fiddler">
<h2>Introducing Fiddler</h2>
<p>So today I prototyped a build system that complements Composer to manage
multiple separate projects/packages in a single repository. I call it <a class="reference external" href="https://github.com/beberlei/fiddler">Fiddler</a>. Fiddler introduces a maintainable
approach to managing dependencies for multiple projects in a single repository,
without losing the benefits of having explicit dependencies for each separate
project.</p>
<p>In practice Fiddler allows you to manage all your third-party dependencies using a
<span class="docutils literal"><span class="pre">composer.json</span></span> file, while adding a new way of managing your internal
dependencies. It combines both external and internal packages to a single
pool and allows you to pick them as dependencies for your projects.</p>
<p>For each project you add a <span class="docutils literal"><span class="pre">fiddler.json</span></span> file where you specify both your
third-party and internal dependencies. Fiddler will take care of generating a
specific autoloader for each project, containing only the dependencies of the
project.  This allows you to have one repository, while still having <em>explicit</em>
dependencies per project.</p>
<p>Keeping explicit dependencies for each project means it’s still easy to find
out which components are affected by changes in internal or third-party
dependencies.</p>
</div>
<div class="section" id="example-project">
<h2>Example Project</h2>
<p>Say you have three packages in your application, Library_1, Project_A
and Project_B and both projects depend on the library which in turn depends
on <span class="docutils literal"><span class="pre">symfony/dependency-injection</span></span>. The repository has the following file structure:</p>
<div class="highlight-default"><div class="highlight"><pre><span/>projects
├── components
│   ├── Project_A
│   │   └── fiddler.json
│   ├── Project_B
│   │   └── fiddler.json
│   └── Library_1
│       └── fiddler.json
├── composer.json
</pre></div>
</div>
<p>The <span class="docutils literal"><span class="pre">fiddler.json</span></span> of Library_1 looks like this::</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="p">{</span>
    <span class="s2">"autoload"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"psr-0"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"Library1</span><span class="se">\\</span><span class="s2">"</span><span class="p">:</span> <span class="s2">"src/"</span><span class="p">}},</span>
    <span class="s2">"deps"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"vendor/symfony/dependency-injection"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <span class="docutils literal"><span class="pre">fiddler.json</span></span> of Project_A and Project_B look similar (except the autoload)::</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="p">{</span>
    <span class="s2">"autoload"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"psr-0"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"ProjectA</span><span class="se">\\</span><span class="s2">"</span><span class="p">:</span> <span class="s2">"src/"</span><span class="p">}},</span>
    <span class="s2">"deps"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"components/Library_1"</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The global <span class="docutils literal"><span class="pre">composer.json</span></span> as you would expect::</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="p">{</span>
    <span class="s2">"require"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"symfony/dependency-injection"</span><span class="p">:</span> <span class="s2">"~2.6"</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As you can see dependencies are specified without version constraints and as
directory paths relative to the project root. Since everything is in one
repository, all internal code is always versioned, tested and deployed
together. Dropping the need for explicit versions when specifying internal
dependencies.</p>
<p>With this setup you can now generate the autoloading files for each package
exactly like Composer would by calling:</p>
<div class="highlight-default"><div class="highlight"><pre><span/>$ php fiddler.phar build
Building fiddler.json projects.
 [Build] components/Library_1
 [Build] components/Project_A
 [Build] components/Project_B
</pre></div>
</div>
<p>Now in each package you can <span class="docutils literal"><span class="pre">require</span> <span class="pre">"vendor/autoload.php";</span></span> and it loads an
autoloader with all the dependencies specified for each component, for example
in <span class="docutils literal"><span class="pre">components/Library_1/index.php</span></span></p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">require_once</span> <span class="s2">"vendor/autoload.php"</span><span class="p">;</span>

<span class="nv">$container</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Symfony\Component\DependencyInjection\ContainerBuilder</span><span class="p">;</span>
</pre></div>
</div>
<p>This is an early access preview, please test this, provide feedback if you see
this as a valuable or not and about possible extensions. See the <a class="reference external" href="https://github.com/beberlei/fiddler">README</a> for more details about functionality
and implementation details.</p>
<p>The code is very rough and simple right now, you will probably stumble accross
some bugs, please <a class="reference external" href="https://github.com/beberlei/fiddler/issues">report them</a>.
It is stable enough so that we could actually port <a class="reference external" href="https://tideways.io">Tideways</a> to it already which is a multi package repository.</p>
</div>


            
            <div class="tags">
                More about: 
                <a href="tags/monorepos.html">Monorepos</a>
                 / 
                <a href="tags/composer.html">Composer</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on April 11, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2015/02/26/integrate_symfony_and_webpack.html">Integrate Symfony and Webpack</a></h1>
<p>Asset Management in Symfony2 is handled with the PHP based library Assetic by
default, however I have never really connected to this library and at least for
me it usually wastes more time than it saves.</p>
<p>I am also not a big fan of the Node.JS based stack, because it tends to fail
alot for me as well. With teams that primarily consist of PHP developers and
web-designers the transition to use Node.JS tools should be very conservative
in my opinion. Each team member should not feel overburdend by this new
technology stack.</p>
<p>Frontend development is really not my strong suit, so these first steps
I document here may seem obvious to some readers.</p>
<p>While researching about <a class="reference external" href="https://github.com/facebook/react">React.JS</a> I came across
a tool called <a class="reference external" href="http://webpack.github.io/">Webpack</a> which you could compare
to Symfony’s Assetic. It is primarily focussing on bundling Javascript modules,
but you can also ship CSS assets with it.</p>
<p>The real benefits for Webpack however are:</p>
<ol class="arabic simple">
<li>the builtin support for AMD or CommonJS style module loaders</li>
<li>a builtin development web-server that runs on a dedicated port, serving your
combined assets.</li>
<li>a hot reloading plugin that automatically refreshes either the full page or
just selected code when the assets change.</li>
<li>module loaders that allow instant translation of JSX or other languages
with Javascript transpilers (CoffeeScript, ...)</li>
</ol>
<p>Let’s have a look at a simple example javascript application in <span class="docutils literal"><span class="pre">app.js</span></span>
requiring jQuery. The code is part of the Symfony2 document root in <span class="docutils literal"><span class="pre">web/</span></span>:</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="n">web</span><span class="o">/</span>
   <span class="n">css</span><span class="o">/</span>
     <span class="n">page</span><span class="o">.</span><span class="n">css</span>
   <span class="n">js</span><span class="o">/</span>
     <span class="n">vendor</span><span class="o">/</span>
       <span class="n">jquery</span><span class="o">.</span><span class="n">js</span>
     <span class="n">app</span><span class="o">.</span><span class="n">js</span>
</pre></div>
</div>
<p>Then we can use <a class="reference external" href="https://github.com/webpack/docs/wiki/amd">AMD-style</a> modules
to resolve the dependencies in our code:</p>
<div class="highlight-js"><div class="highlight"><pre><span/><span class="c1">// app.js</span>
<span class="nx">define</span><span class="p">([</span><span class="s1">'./vendor/jquery.js'</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">"#content"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"Webpack Hello World!"</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can compare this to PHPs <span class="docutils literal"><span class="pre">require()</span></span> and autoloading functionality,
something that Javascript has historically been lacking and usually leads to
javascript files with many thousands lines of code. You can also use
<a class="reference external" href="https://github.com/webpack/docs/wiki/commonjs">CommonJS-style</a> module loading
if your prefer this approach.</p>
<p>The downside of adding this functionality is that your code <strong>always</strong> has to
run through Webpack to work on the browser. But Webpack solves this geniously
by including a web-server that does the translation for you in the background
all the time.  With a little help of a configuration file called <span class="docutils literal"><span class="pre">webpack.config.js</span></span></p>
<div class="highlight-js"><div class="highlight"><pre><span/><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">entry</span>   <span class="o">:</span> <span class="s2">"./web/js/app.js"</span><span class="p">,</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s2">"bundle.js"</span><span class="p">,</span>
        <span class="nx">path</span> <span class="o">:</span> <span class="s1">'web/assets/'</span><span class="p">,</span>
        <span class="nx">publicPath</span> <span class="o">:</span> <span class="s1">'/assets/'</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>we can start our assets development server by calling:</p>
<div class="highlight-default"><div class="highlight"><pre><span/>$ webpack-dev-server --progress --colors --port 8090 --content-base=web/
</pre></div>
</div>
<p>This will start serving the combined javascript file at
<span class="docutils literal"><span class="pre">http://localhost:8090/assets/bundle.js</span></span> as well as the asset <span class="docutils literal"><span class="pre">page.css</span></span> at
<span class="docutils literal"><span class="pre">http://localhost:8090/css/page.css</span></span> by using the <span class="docutils literal"><span class="pre">--content-base</span></span> flag.
Every change to any of the files that are part of the result will trigger a
rebuild similar to the <span class="docutils literal"><span class="pre">--watch</span></span> flag of Assetic, Grunt or Gulp.</p>
<p>Webpack can be installed globally so it is easy to get started with. I find
this a huge benefit not having to require a <span class="docutils literal"><span class="pre">package.json</span></span> and Node+npm
workflow for your PHP/Symfony project.</p>
<div class="highlight-default"><div class="highlight"><pre><span/>$ sudo npm install -g webpack
</pre></div>
</div>
<p>For integration into Symfony we make use of some Framework configuration to
change the base path used for the <span class="docutils literal"><span class="pre">{{</span> <span class="pre">asset()</span> <span class="pre">}}</span></span> twig-function:</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="c1"># app/config/config.yml</span>
<span class="n">framework</span><span class="p">:</span>
  <span class="n">templating</span><span class="p">:</span>
    <span class="n">assets_base_url</span><span class="p">:</span> <span class="s2">"%assets_base_url%"</span>

<span class="c1"># app/config/parameters.yml</span>
<span class="n">parameters</span><span class="p">:</span>
  <span class="n">assets_base_url</span><span class="p">:</span> <span class="s2">"http://localhost:8090"</span>
</pre></div>
</div>
<p>This adds a base path in front of all your assets pointing to the Webpack dev
server.</p>
<p>The only thing left for integration is to load the javascript file from your
twig layout file:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span/><span class="x">&lt;html&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;div id="content"&gt;&lt;/div&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">app.environment</span> <span class="o">==</span> <span class="s2">"dev"</span> <span class="cp">%}</span><span class="x"/>
<span class="x">        &lt;script src="</span><span class="cp">{{</span> <span class="nv">asset</span><span class="o">(</span><span class="s1">'webpack-dev-server.js'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"&gt;&lt;/script&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"/>
<span class="x">        &lt;script type="text/javascript" src="</span><span class="cp">{{</span> <span class="nv">asset</span><span class="o">(</span><span class="s1">'assets/bundle.js'</span><span class="o">)</span> <span class="cp">}}</span><span class="x">"&gt;&lt;/script&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p>The <span class="docutils literal"><span class="pre">webpack-dev-server.js</span></span> file loaded only in development environment
handles the <a class="reference external" href="https://webpack.js.org/concepts/hot-module-replacement/">hot module reload</a>
exchanging, adding, or removing modules while an application is running without
a page reload whenever possible.</p>
<p>For production use the <span class="docutils literal"><span class="pre">assets_base_url</span></span> parameter has to be adjusted
to your specific needs and you use the <span class="docutils literal"><span class="pre">webpack</span></span> command to generate a
minified and optimized version of your javascript code.</p>
<div class="highlight-default"><div class="highlight"><pre><span/>$ webpack
Hash: 69657874504a1a1db7cf
Version: webpack 1.6.0
Time: 329ms
    Asset   Size  Chunks             Chunk Names
bundle.js  30533       0  [emitted]  main
   [2] ./web/js/app.js 1608 {0} [built]
   [5] ./web/js/vendor/jquery.js 496 {0} [built]
</pre></div>
</div>
<p>It will be placed inside <span class="docutils literal"><span class="pre">web/assets/bundle.js</span></span> as specified by the output
configuration in the Webpack configuration. Getting started in production is as
easy as seting the assets base url to null and pushing the bundle.js to your
production server.</p>
<p>I hope this example shows you some of the benefits of using Webpack over
Assetic, Grunt or Gulp and the simplicity using it between development and
production. While the example is Symfony2 related, the concepts apply to any
kind of application.</p>
<p>Back to why I stumbled over Webpack in the first place: React.JS. I have been
circling around React for a while with the impression that is extremly
well-suited for frontend development. The problems I had with React where
purely operation/workflow based:</p>
<ol class="arabic simple">
<li>React encourages modular design of applications, something that you
have to get working first using require.js for example.</li>
<li>Differentation between development (refresh on modify) and production assets
(minified).</li>
<li>React uses a template language JSX that requires cross-compiling the
<span class="docutils literal"><span class="pre">*.jsx</span></span> files they are written in into plain javascript files.</li>
</ol>
<p>Now this blog post has already shown that Webpack solves points one and two,
but it also solves the JSX Transformation with some extra configuration
in <span class="docutils literal"><span class="pre">webpack.config.js</span></span>:</p>
<div class="highlight-js"><div class="highlight"><pre><span/><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">entry</span><span class="o">:</span> <span class="s1">'./web/js/app.jsx'</span><span class="p">,</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s1">'bundle.js'</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">'web/assets/'</span><span class="p">,</span>
        <span class="nx">publicPath</span><span class="o">:</span> <span class="s1">'/assets'</span>
    <span class="p">},</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">loaders</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.jsx$/</span><span class="p">,</span> <span class="nx">loader</span><span class="o">:</span> <span class="s1">'jsx-loader?insertPragma=React.DOM&amp;harmony'</span> <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">externals</span><span class="o">:</span> <span class="p">{</span><span class="s1">'react'</span><span class="o">:</span> <span class="s1">'React'</span><span class="p">},</span>
    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span><span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">''</span><span class="p">,</span> <span class="s1">'.js'</span><span class="p">,</span> <span class="s1">'.jsx'</span><span class="p">]}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now it is trivally easy to use React, just create a file with the <span class="docutils literal"><span class="pre">*.jsx</span></span>
extension and Webpack will automatically load it through Facebooks JSX
transformer before serving it as plain javascript. The only requirement is that
you have to install the NPM package <span class="docutils literal"><span class="pre">jsx-loader</span></span>.</p>
<p>So far I have used webpack only for two playground projects, but I am very
confident integrating it into some of my production projects now.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/symfony.html">Symfony</a>
                 / 
                <a href="tags/webpack.html">Webpack</a>
                 / 
                <a href="tags/javascript.html">Javascript</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on February 26, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2015/02/19/vagrant_nfs_and_npm.html">Vagrant, NFS and NPM</a></h1>
<p>I have ranted about Node.JS and NPM on Twitter before, costing me lots of time,
so I have to make up for this now and offer some solutions.</p>
<p>One problem I regularly have is the following: I have a Vagrant/Virtualbox
using NFS and want to run NPM inside of that. Running it inside the box
is necessary, because I don’t want everyone using the box have to setup the
node stack.</p>
<p>However running <span class="docutils literal"><span class="pre">npm</span> <span class="pre">install</span></span> on an NFS share doesn’t work as per <a class="reference external" href="https://github.com/npm/npm/issues/3565">issue
#3565</a> because a chmod fails and
apparently from the ticket, this is not going to be fixed.</p>
<p>I finally got it working with a <a class="reference external" href="https://gist.github.com/kevinastone/8790717">workaround script</a> by <a class="reference external" href="https://github.com/kevinastone">Kevin
Stone</a> that mimics NPM, but
moves the <span class="docutils literal"><span class="pre">package.json</span></span> to a temporary directory and then rsyncs its back:</p>
<div class="highlight-default"><div class="highlight"><pre><span/>#!/bin/bash
# roles/nodejs/files/tmpnpm.sh

BASE_DIR=${TMPDIR:-/var/tmp}
ORIG_DIR=$PWD
HASH_CMD="md5sum"

DIR_NAME=`echo $PWD | $HASH_CMD | cut -f1 -d " "`

TMP_DIR=$BASE_DIR/$DIR_NAME
mkdir -p $TMP_DIR

pushd $TMP_DIR

ln -sf $ORIG_DIR/package.json
npm $1

# Can't use archive mode cause of the permissions
rsync --recursive --links --times node_modules $ORIG_DIR

popd
</pre></div>
</div>
<p>Integrating this into my Ansible setup of the machine it looked like this:</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="c1"># roles/nodejs/tasks/main.yml</span>
<span class="c1"># More tasks here before this...</span>
<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">"Install npm workaround"</span>
  <span class="n">copy</span><span class="p">:</span> <span class="o">&gt;</span>
      <span class="n">src</span><span class="o">=</span><span class="n">tmpnpm</span><span class="o">.</span><span class="n">sh</span>
      <span class="n">dest</span><span class="o">=/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmpnpm</span>
      <span class="n">mode</span><span class="o">=</span><span class="s2">"0755"</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">"Install Global Dependencies"</span>
  <span class="n">command</span><span class="p">:</span> <span class="o">&gt;</span>
      <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmpnpm</span> <span class="n">install</span> <span class="o">-</span><span class="n">g</span> <span class="p">{{</span> <span class="n">item</span> <span class="p">}}</span>
  <span class="n">with_items</span><span class="p">:</span> <span class="n">global_packages</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="s2">"Install Package Dependencies"</span>
  <span class="n">command</span><span class="p">:</span> <span class="o">&gt;</span>
      <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">tmpnpm</span> <span class="n">install</span>
      <span class="n">chdir</span><span class="o">=</span><span class="p">{{</span> <span class="n">item</span> <span class="p">}}</span>
  <span class="n">with_items</span><span class="p">:</span> <span class="n">package_dirs</span>
</pre></div>
</div>
<p>Where <span class="docutils literal"><span class="pre">global_packages</span></span> and <span class="docutils literal"><span class="pre">package_dirs</span></span> are specified from the
outside when invoking the role:</p>
<div class="highlight-default"><div class="highlight"><pre><span/><span class="c1"># deploy.yml</span>
<span class="o">---</span>
<span class="o">-</span> <span class="n">hosts</span><span class="p">:</span> <span class="nb">all</span>
  <span class="n">roles</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">nodejs</span>
      <span class="n">global_packages</span><span class="p">:</span>
        <span class="o">-</span> <span class="n">grunt</span><span class="o">-</span><span class="n">cli</span>
      <span class="n">package_dirs</span><span class="p">:</span>
        <span class="o">-</span> <span class="s2">"/var/www/project"</span>
</pre></div>
</div>
<p>This way the Ansible Node.JS role is reusable in different projects.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/vagrant.html">Vagrant</a>
                 / 
                <a href="tags/ansible.html">Ansible</a>
                 / 
                <a href="tags/javascript.html">Javascript</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on February 19, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2015/02/14/phpunit_before_annotations_and_traits_for_code_reuse.html">PHPunit @before Annotations and traits for code-reuse</a></h1>
<p>I have written about why I think <a class="reference external" href="http://www.whitewashing.de/2013/04/12/traits_are_static_access.html">traits should be avoided</a>. There
is a practical use-case that serves me well however: Extending PHPUnit tests.</p>
<p>The PHPUnit TestCase is not very extendable except through inheritance. This
often leads to a weird, deep inheritance hierachy in testsuites to achieve code
reuse. For example the Doctrine ORM testsuite having <span class="docutils literal"><span class="pre">OrmFunctionalTestCase</span></span>
extending from <span class="docutils literal"><span class="pre">OrmTestCase</span></span> extending from PHPUnits testcase.</p>
<p>Dependency Injection is something that is not possible easily in a PHPUnit
testcase, but could be solved using an additional listener and some
configuration in <span class="docutils literal"><span class="pre">phpunit.xml</span></span>.</p>
<p>This leaves traits as a simple mechanism that doesn’t require writing an
extension for PHPUnit and allows “multiple inheritance” to compose different
features for our test cases.</p>
<p>See this simple example that is adding some more assertions:</p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">trait</span> <span class="nx">MyAssertions</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">assertIsNotANumber</span><span class="p">(</span><span class="nv">$value</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertTrue</span><span class="p">(</span><span class="nb">is_nan</span><span class="p">(</span><span class="nv">$value</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">MathTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">MyAssertions</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testIsNotANumber</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertIsNotANumber</span><span class="p">(</span><span class="nb">acos</span><span class="p">(</span><span class="mi">8</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When you have more complex requirements, you might need the trait to implement
<span class="docutils literal"><span class="pre">setUp()</span></span> method. This will prevent you from using multiple traits that all
need to invoke <span class="docutils literal"><span class="pre">setUp()</span></span>. You could use the trait conflict resolution, but
then the renamed setup methods do not get called anymore.</p>
<p>Fortunately PHPUnit 3.8+ comes to the rescue with new <span class="docutils literal"><span class="pre">@before</span></span> and
<span class="docutils literal"><span class="pre">@beforeClass</span></span> annotations.</p>
<p>See this trait I use for making sure my database is using the
most current database version by invoking migrations in <span class="docutils literal"><span class="pre">@beforeClass</span></span></p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Xhprof</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Doctrine\DBAL\DriverManager</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">DatabaseSetup</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">private</span> <span class="k">static</span> <span class="nv">$initialized</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @beforeClass</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">initializeDatabase</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="o">::</span><span class="nv">$initialized</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">self</span><span class="o">::</span><span class="nv">$initialized</span> <span class="o">=</span> <span class="k">true</span><span class="p">;</span>

        <span class="nv">$conn</span> <span class="o">=</span> <span class="nx">DriverManager</span><span class="o">::</span><span class="na">getConnection</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
            <span class="s1">'url'</span> <span class="o">=&gt;</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'TEST_DATABASE_DSN'</span><span class="p">]</span>
        <span class="p">));</span>

        <span class="nv">$dbDeploy</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DbDeploy</span><span class="p">(</span><span class="nv">$conn</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="no">__DIR__</span> <span class="o">.</span> <span class="s1">'/../../src/schema'</span><span class="p">));</span>
        <span class="nv">$dbDeploy</span><span class="o">-&gt;</span><span class="na">migrate</span><span class="p">();</span>
        <span class="nv">$conn</span><span class="o">-&gt;</span><span class="na">close</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>I could mix this with a second trait <span class="docutils literal"><span class="pre">SymfonySetup</span></span> that makes the DIC
container available for my integration tests:</p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">Xhprof</span><span class="p">;</span>

<span class="k">trait</span> <span class="nx">SymfonySetup</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$kernel</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$container</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * @before</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">setupKernel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createKernel</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="o">-&gt;</span><span class="na">boot</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="o">-&gt;</span><span class="na">getContainer</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">protected</span> <span class="k">function</span> <span class="nf">createKernel</span><span class="p">(</span><span class="k">array</span> <span class="nv">$options</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nx">\AppKernel</span><span class="p">(</span><span class="s1">'test'</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @after</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">function</span> <span class="nf">tearDownSymfonyKernel</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">null</span> <span class="o">!==</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">kernel</span><span class="o">-&gt;</span><span class="na">shutdown</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The Symfony setup trait uses <span class="docutils literal"><span class="pre">@before</span></span> and <span class="docutils literal"><span class="pre">@after</span></span> to setup and cleanup
without clashing with the traditional PHPUnit <span class="docutils literal"><span class="pre">setUp</span></span> method.</p>
<p>Combining all this we could write a testcase like this:</p>
<div class="highlight-php"><div class="highlight"><pre><span/><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">UserRepositoryTest</span> <span class="k">extends</span> <span class="nx">\PHPUnit_Framework_TestCase</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">DatabaseSetup</span><span class="p">;</span>
    <span class="k">use</span> <span class="nx">SymfonySetup</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">setUp</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="c1">// do setup here</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testNotFindUserReturnsNull</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$userRepository</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">container</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'user_repository'</span><span class="p">);</span>
        <span class="nv">$unusedId</span> <span class="o">=</span> <span class="mi">9999</span><span class="p">;</span>
        <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$userRepository</span><span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$unusedId</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">assertNull</span><span class="p">(</span><span class="nv">$user</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Sadly the <span class="docutils literal"><span class="pre">@before</span></span> calls are invoced <em>after</em> the original <span class="docutils literal"><span class="pre">setup()</span></span> method
so we cannot access the Symfony container here already. Maybe it would be more
practical to have it work the other way around. I have <a class="reference external" href="https://github.com/sebastianbergmann/phpunit/issues/1616">opened an issue on
PHPUnit</a> for that.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/testing.html">Testing</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on February 14, 2015
                 by Benjamin Eberlei
            </small>
        </p>
    </div>
        </div><div class="archive_link">
        <a href="archive.html">Archive</a>
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2018, Benjamin Eberlei.</small>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-32146757-1', 'auto');
          ga('send', 'pageview');
        </script>

    </body>
</html>
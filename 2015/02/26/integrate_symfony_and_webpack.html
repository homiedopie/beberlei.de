<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Integrate Symfony and Webpack &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="../../../_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../../../_static/plugins.js"></script>
        <script src="../../../_static/main.js"></script>
        <link rel="next" title="Vagrant, NFS and NPM" href="../19/vagrant_nfs_and_npm.html" /><link rel="prev" title="Monolithic Repositories with PHP and Composer" href="../../04/11/monolithic_repositories_with_php_and_composer.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script><script type="text/javascript" src="../../../_static/disqus.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="../../../index.html">Home</a></li>
						<li><a href="../../../pages/about.html">About</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="blog-post">
        <div class="section" id="integrate-symfony-and-webpack">
<h1>Integrate Symfony and Webpack</h1>
<p>Asset Management in Symfony2 is handled with the PHP based library Assetic by
default, however I have never really connected to this library and at least for
me it usually wastes more time than it saves.</p>
<p>I am also not a big fan of the Node.JS based stack, because it tends to fail
alot for me as well. With teams that primarily consist of PHP developers and
web-designers the transition to use Node.JS tools should be very conservative
in my opinion. Each team member should not feel overburdend by this new
technology stack.</p>
<p>Frontend development is really not my strong suit, so these first steps
I document here may seem obvious to some readers.</p>
<p>While researching about <a class="reference external" href="https://github.com/facebook/react">React.JS</a> I came across
a tool called <a class="reference external" href="http://webpack.github.io/">Webpack</a> which you could compare
to Symfony&#8217;s Assetic. It is primarily focussing on bundling Javascript modules,
but you can also ship CSS assets with it.</p>
<p>The real benefits for Webpack however are:</p>
<ol class="arabic simple">
<li>the builtin support for AMD or CommonJS style module loaders</li>
<li>a builtin development web-server that runs on a dedicated port, serving your
combined assets.</li>
<li>a hot reloading plugin that automatically refreshes either the full page or
just selected code when the assets change.</li>
<li>module loaders that allow instant translation of JSX or other languages
with Javascript transpilers (CoffeeScript, ...)</li>
</ol>
<p>Let&#8217;s have a look at a simple example javascript application in <span class="docutils literal"><span class="pre">app.js</span></span>
requiring jQuery. The code is part of the Symfony2 document root in <span class="docutils literal"><span class="pre">web/</span></span>:</p>
<div class="highlight-python"><div class="highlight"><pre>web/
   css/
     page.css
   js/
     vendor/
       jquery.js
     app.js
</pre></div>
</div>
<p>Then we can use <a class="reference external" href="http://webpack.github.io/docs/amd.html">AMD-style</a> modules
to resolve the dependencies in our code:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="c1">// app.js</span>
<span class="nx">define</span><span class="p">([</span><span class="s1">&#39;./vendor/jquery.js&#39;</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#content&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">&quot;Webpack Hello World!&quot;</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>You can compare this to PHPs <span class="docutils literal"><span class="pre">require()</span></span> and autoloading functionality,
something that Javascript has historically been lacking and usually leads to
javascript files with many thousands lines of code. You can also use
<a class="reference external" href="http://webpack.github.io/docs/commonjs.html">CommonJS-style</a> module loading
if your prefer this approach.</p>
<p>The downside of adding this functionality is that your code <strong>always</strong> has to
run through Webpack to work on the browser. But Webpack solves this geniously
by including a web-server that does the translation for you in the background
all the time.  With a little help of a configuration file called <span class="docutils literal"><span class="pre">webpack.config.js</span></span></p>
<div class="highlight-js"><div class="highlight"><pre><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">entry</span>   <span class="o">:</span> <span class="s2">&quot;./web/js/app.js&quot;</span><span class="p">,</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s2">&quot;bundle.js&quot;</span><span class="p">,</span>
        <span class="nx">path</span> <span class="o">:</span> <span class="s1">&#39;web/assets/&#39;</span><span class="p">,</span>
        <span class="nx">publicPath</span> <span class="o">:</span> <span class="s1">&#39;/assets/&#39;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>we can start our assets development server by calling:</p>
<div class="highlight-python"><div class="highlight"><pre>$ webpack-dev-server --progress --colors --port 8090 --content-base=web/
</pre></div>
</div>
<p>This will start serving the combined javascript file at
<span class="docutils literal"><span class="pre">http://localhost:8090/assets/bundle.js</span></span> as well as the asset <span class="docutils literal"><span class="pre">page.css</span></span> at
<span class="docutils literal"><span class="pre">http://localhost:8090/css/page.css</span></span> by using the <span class="docutils literal"><span class="pre">--content-base</span></span> flag.
Every change to any of the files that are part of the result will trigger a
rebuild similar to the <span class="docutils literal"><span class="pre">--watch</span></span> flag of Assetic, Grunt or Gulp.</p>
<p>Webpack can be installed globally so it is easy to get started with. I find
this a huge benefit not having to require a <span class="docutils literal"><span class="pre">package.json</span></span> and Node+npm
workflow for your PHP/Symfony project.</p>
<div class="highlight-python"><div class="highlight"><pre>$ sudo npm install -g webpack
</pre></div>
</div>
<p>For integration into Symfony we make use of some Framework configuration to
change the base path used for the <span class="docutils literal"><span class="pre">{{</span> <span class="pre">asset()</span> <span class="pre">}}</span></span> twig-function:</p>
<div class="highlight-python"><div class="highlight"><pre># app/config/config.yml
framework:
  templating:
    assets_base_url: &quot;%assets_base_url%&quot;

# app/config/parameters.yml
parameters:
  assets_base_url: &quot;http://localhost:8090&quot;
</pre></div>
</div>
<p>This adds a base path in front of all your assets pointing to the Webpack dev
server.</p>
<p>The only thing left for integration is to load the javascript file from your
twig layout file:</p>
<div class="highlight-jinja"><div class="highlight"><pre><span class="x">&lt;html&gt;</span>
<span class="x">    &lt;body&gt;</span>
<span class="x">        &lt;div id=&quot;content&quot;&gt;&lt;/div&gt;</span>

<span class="x">        </span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">app.environment</span> <span class="o">==</span> <span class="s2">&quot;dev&quot;</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;script src=&quot;</span><span class="cp">{{</span> <span class="nv">asset</span><span class="o">(</span><span class="s1">&#39;webpack-dev-server.js&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;&lt;/script&gt;</span>
<span class="x">        </span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="x"></span>
<span class="x">        &lt;script type=&quot;text/javascript&quot; src=&quot;</span><span class="cp">{{</span> <span class="nv">asset</span><span class="o">(</span><span class="s1">&#39;assets/bundle.js&#39;</span><span class="o">)</span> <span class="cp">}}</span><span class="x">&quot;&gt;&lt;/script&gt;</span>
<span class="x">    &lt;/body&gt;</span>
<span class="x">&lt;/html&gt;</span>
</pre></div>
</div>
<p>The <span class="docutils literal"><span class="pre">webpack-dev-server.js</span></span> file loaded only in development environment
handles the <a class="reference external" href="http://webpack.github.io/docs/hot-module-replacement-with-webpack.html">hot module reload</a>
exchanging, adding, or removing modules while an application is running without
a page reload whenever possible.</p>
<p>For production use the <span class="docutils literal"><span class="pre">assets_base_url</span></span> parameter has to be adjusted
to your specific needs and you use the <span class="docutils literal"><span class="pre">webpack</span></span> command to generate a
minified and optimized version of your javascript code.</p>
<div class="highlight-python"><div class="highlight"><pre>$ webpack
Hash: 69657874504a1a1db7cf
Version: webpack 1.6.0
Time: 329ms
    Asset   Size  Chunks             Chunk Names
bundle.js  30533       0  [emitted]  main
   [2] ./web/js/app.js 1608 {0} [built]
   [5] ./web/js/vendor/jquery.js 496 {0} [built]
</pre></div>
</div>
<p>It will be placed inside <span class="docutils literal"><span class="pre">web/assets/bundle.js</span></span> as specified by the output
configuration in the Webpack configuration. Getting started in production is as
easy as seting the assets base url to null and pushing the bundle.js to your
production server.</p>
<p>I hope this example shows you some of the benefits of using Webpack over
Assetic, Grunt or Gulp and the simplicity using it between development and
production. While the example is Symfony2 related, the concepts apply to any
kind of application.</p>
<p>Back to why I stumbled over Webpack in the first place: React.JS. I have been
circling around React for a while with the impression that is extremly
well-suited for frontend development. The problems I had with React where
purely operation/workflow based:</p>
<ol class="arabic simple">
<li>React encourages modular design of applications, something that you
have to get working first using require.js for example.</li>
<li>Differentation between development (refresh on modify) and production assets
(minified).</li>
<li>React uses a template language JSX that requires cross-compiling the
<span class="docutils literal"><span class="pre">*.jsx</span></span> files they are written in into plain javascript files.</li>
</ol>
<p>Now this blog post has already shown that Webpack solves points one and two,
but it also solves the JSX Transformation with some extra configuration
in <span class="docutils literal"><span class="pre">webpack.config.js</span></span>:</p>
<div class="highlight-js"><div class="highlight"><pre><span class="c1">// webpack.config.js</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./web/js/app.jsx&#39;</span><span class="p">,</span>
    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
        <span class="nx">path</span><span class="o">:</span> <span class="s1">&#39;web/assets/&#39;</span><span class="p">,</span>
        <span class="nx">publicPath</span><span class="o">:</span> <span class="s1">&#39;/assets&#39;</span>
    <span class="p">},</span>
    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">loaders</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span> <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.jsx$/</span><span class="p">,</span> <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;jsx-loader?insertPragma=React.DOM&amp;harmony&#39;</span> <span class="p">}</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="nx">externals</span><span class="o">:</span> <span class="p">{</span><span class="s1">&#39;react&#39;</span><span class="o">:</span> <span class="s1">&#39;React&#39;</span><span class="p">},</span>
    <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span><span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.jsx&#39;</span><span class="p">]}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Now it is trivally easy to use React, just create a file with the <span class="docutils literal"><span class="pre">*.jsx</span></span>
extension and Webpack will automatically load it through Facebooks JSX
transformer before serving it as plain javascript. The only requirement is that
you have to install the NPM package <span class="docutils literal"><span class="pre">jsx-loader</span></span>.</p>
<p>So far I have used webpack only for two playground projects, but I am very
confident integrating it into some of my production projects now.</p>
</div>

        
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2017, Benjamin Eberlei.</small>

						<script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->
    </body>
</html>
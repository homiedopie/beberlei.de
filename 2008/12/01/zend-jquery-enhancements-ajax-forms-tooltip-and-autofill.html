<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Zend + jQuery Enhancements: Ajax Forms, Tooltip and Autofill &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="../../../_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="../../../_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="../../../_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="../../../_static/plugins.js"></script>
        <script src="../../../_static/main.js"></script>
        <link rel="search" title="Search" href="../../../search.html" /><link rel="next" title="Dependency Injection the juicy way" href="../18/dependecy-injection-the-juicy-way.html" /><link rel="prev" title="Dependency Injection with PHP: Introducing Sphicy" href="../30/dependency-injection-with-php-introducing-sphicy.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../',
        VERSION:     '1.5.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="../../../_static/underscore.js"></script><script type="text/javascript" src="../../../_static/doctools.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="../../../index.html">Home</a></li>
						<li><a href="../../../pages/about.html">About</a></li>
						<li><a href="../../../pages/debugging_php.html">Debugging</a></li>
						<li><a href="../../../pages/imprint.html">Imprint</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="blog-post">
        <div class="section" id="zend-jquery-enhancements-ajax-forms-tooltip-and-autofill">
<h1>Zend + jQuery Enhancements: Ajax Forms, Tooltip and Autofill</h1>
<p>Some weeks ago <a class="reference external" href="http://framework.zend.com">Zend Framework 1.7</a> was
released with the <a class="reference external" href="http://jquery.com">jQuery</a> support I contributed.
What is the essential advantage of using jQuery support in ZF? You can
develop forms with ajax support either by using View Helpers or directly
by the integrated Zend_Form support. The implementation of a DatePicker
or AutoComplete functionality becomes as easy as using 2-3 lines of php
code.</p>
<p>Currently only support for the jQuery UI library is shipped, but you can
easily extend the jQuery support on your own and this blog post will
show you how using three very popular jQuery plugins:
<a class="reference external" href="http://malsup.com/jquery/form/">AjaxForm</a>,
<a class="reference external" href="http://bassistance.de/jquery-plugins/jquery-plugin-tooltip/">Tooltip</a>
and <a class="reference external" href="http://plugins.jquery.com/project/Autofill">AutoFill</a>. This will
be a series of installments, beginning with the first one: AjaxForms</p>
<p>AjaxForm allows you to enhance any form of yours to submit the data with
ajax to the server, so no additional overhead of loading a new page is
necessary. Combining the power of Zend_Form and jQuery&#8217;s ajaxForm you
can even go so far as differentiating between successful and
non-validated form submits. We will build a Form Decorator that
integrates the AjaxForm plugin in any of your Zend_Form&#8217;s. On submit it
will send the form data to the server via ajax and clears the form
afterwards. Clients that have javascript disabled will work too, the
form is submitted to the server in a standard pre-ajax fashion and
processed that way.</p>
<p>First what we need is obviously the new decorator, we will call it
&#8220;My_JQuery_Form_Decorator_AjaxForm&#8221; and it will inherit from
Zend_Form_Decorator_Form. What we then realize is, that this is just
using a view helper to render, so what we need additionally is a
&#8220;My_JQuery_View_Helper_AjaxForm&#8221; that extends from
&#8220;Zend_View_Helper_Form&#8221;. The code of the view helper will have to
look as follows to fulfil our needs:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>require_once &quot;Zend/View/Helper/Form.php&quot;;class ZendX_JQuery_View_Helper_AjaxForm extends Zend_View_Helper_Form{  /**   * Contains reference to the jQuery view helper   *   * @var ZendX_JQuery_View_Helper_JQuery_Container   */  protected $jquery;  /**   * Set view and enable jQuery Core and UI libraries   *   * @param Zend_View_Interface $view   * @return ZendX_JQuery_View_Helper_Widget   */  public function setView(Zend_View_Interface $view)  {    parent::setView($view);    $this-&gt;jquery = $this-&gt;view-&gt;jQuery();    $this-&gt;jquery-&gt;enable()           -&gt;uiEnable();    return $this;  }  public function ajaxForm($name, $attribs = null, $content = false, array $options=array())  {    $id = $name;    if(isset($attribs[&#39;id&#39;])) {      $id = $attribs[&#39;id&#39;];    }    if(!isset($options[&#39;clearForm&#39;])) {      $options[&#39;clearForm&#39;] = true;    }    if(count($options) &gt; 0) {      require_once &quot;Zend/Json.php&quot;;      $jsonOptions = Zend_Json::encode($options);      // Fix Callbacks if present      if(isset($options[&#39;beforeSubmit&#39;])) {        $jsonOptions = str_replace(&#39;&quot;beforeSubmit&quot;:&quot;&#39;.$options[&#39;beforeSubmit&#39;].&#39;&quot;&#39;, &#39;&quot;beforeSubmit&quot;:&#39;.$options[&#39;beforeSubmit&#39;], $jsonOptions);      }      if(isset($options[&#39;success&#39;])) {        $jsonOptions = str_replace(&#39;&quot;success&quot;:&quot;&#39;.$options[&#39;success&#39;].&#39;&quot;&#39;, &#39;&quot;success&quot;:&#39;.$options[&#39;success&#39;], $jsonOptions);      }    } else {      $jsonOptions = &quot;{}&quot;;    }    $this-&gt;jquery-&gt;addOnLoad(sprintf(      &#39;$(&quot;#%s&quot;).ajaxForm(%s)&#39;, $id, $jsonOptions    ));    return parent::form($name, $attribs, $content);  }}
</pre></div>
</div>
</div></blockquote>
<p>It takes all the form-tag building of the inherited view helper for
granted and just appends the necessary jQuery code to the jQuery
onLoadActions stack. They will be outputted to the clients browser when
calling &lt;?php $this-&gt;jQuery(); ?&gt; in your layout or view script. Make
sure that you include the jQuery Form plugin in your code, for example
with &lt;?php $view-&gt;jQuery()-&gt;addJavascriptFile(..); &gt;</p>
<p>Programming the decorator becomes a simple trick now:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>require_once &quot;Zend/Form/Decorator/Form.php&quot;;class My_JQuery_Form_Decorator_AjaxForm extends Zend_Form_Decorator_Form{  protected $_helper = &quot;ajaxForm&quot;;  protected $_jQueryParams = array();  public function getOptions()  {    $options = parent::getOptions();    if(isset($options[&#39;jQueryParams&#39;])) {      $this-&gt;_jQueryParams = $options[&#39;jQueryParams&#39;];      unset($options[&#39;jQueryParams&#39;]);      unset($this-&gt;_options[&#39;jQueryParams&#39;]);    }    return $options;  }  /**   * Render a form   *   * Replaces $content entirely from currently set element.   *   * @param string $content   * @return string   */  public function render($content)  {    $form  = $this-&gt;getElement();    $view  = $form-&gt;getView();    if (null === $view) {      return $content;    }    $helper    = $this-&gt;getHelper();    $attribs    = $this-&gt;getOptions();    $name     = $form-&gt;getFullyQualifiedName();    $attribs[&#39;id&#39;] = $form-&gt;getId();    return $view-&gt;$helper($name, $attribs, $content, $this-&gt;_jQueryParams);  }}
</pre></div>
</div>
</div></blockquote>
<p>Now to use either the decorator for your form, or just the view helper
to print your form tag with jQuery code you can invoke:</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>$form-&gt;addPrefixPath(&#39;My_JQuery_Form_Decorator&#39;, &#39;My/JQuery/Form/Decorator&#39;, &#39;decorator&#39;);$form-&gt;removeDecorator(&#39;Form&#39;)-&gt;addDecorator(array(&#39;AjaxForm&#39;, array(  &#39;jQueryParams&#39; =&gt; array(),)));$view-&gt;addHelperPath(&quot;My/JQuery/View/Helper&quot;, &quot;My_JQuery_View_Helper&quot;);$view-&gt;ajaxForm(&quot;formId1&quot;, $attribs, $content, $options);
</pre></div>
</div>
</div></blockquote>
<p>Now we finished up the view side of our script. Assuming that we use the
Form Decorator instead of the View Helper, we can additionally add some
fancy logic and error handling ajax fun to the action controller that is
handling the Zend_Form instance.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>class IndexController extends Zend_Controller_Action{  public function indexAction()  {    $foo = new MyAjaxTestForm();    try {      if(!$foo-&gt;isValid($_POST)) {        throw new Exception(&quot;Form is not valid!&quot;);      } else {        // do much saving and stuff here        if($this-&gt;getRequest()-&gt;isXmlHttpRequest()) {          $this-&gt;_helper-&gt;json(array(&quot;success&quot; =&gt; &quot;SUCCESSMESSAGEHERE&quot;));        }      }    } catch(Exception $e) {      if($this-&gt;getRequest()-&gt;isXmlHttpRequest()) {        $jsonErrors = array();        foreach( ( new RecursiveIteratorIterator(new RecursiveArrayIterator($form-&gt;getMessages())) ) AS $error) {          $jsonErrors[] = $error;        }        $this-&gt;_helper-&gt;json-&gt;sendJson($jsonErrors);      }    }  }}
</pre></div>
</div>
</div></blockquote>
<p>This has to be processed by a callback function of the AjaxForm and
which may for example look like the following which uses a predefined
div box (#formMessages, don&#8217;t forget to implement it) to render either
the success or the error messages.</p>
<blockquote>
<div><div class="highlight-default"><div class="highlight"><pre><span></span>$form-&gt;addDecorator(array(&#39;AjaxForm&#39;, array(  &#39;jQueryParams&#39; =&gt; array(    &#39;success&#39; =&gt; &quot;formCallback1&quot;,   ),)));$view-&gt;jQuery()-&gt;addJavascript(&#39;function formCallback1(data) {  if(data.errors) {    $(&quot;#formMessages&quot;).append(&quot;&lt;ul&gt;&quot;);    for each(var item in data.errors) {      $(&quot;#formMessages&quot;).append(&quot;&lt;li&gt;&quot;+item+&quot;&lt;/li&gt;&quot;);    }    $(&quot;#formMessages&quot;).append(&quot;&lt;/ul&gt;&quot;);  } else {    $(&quot;#formMessages&quot;).html(data.success);  }}&#39;);
</pre></div>
</div>
</div></blockquote>
<p>This seems very complex, but you could include that javascript code into
the AjaxForm decorator and implement an Action Helper to do the action
controller side of the stuff. This will be an exercise for a future
post.</p>
<p>AutoFill and Tooltip extensions will be topic of the next installments
of this series, so be aware of new content soonish.</p>
</div>


        
        
        <div class="tags">
            More about: 
            <a href="../../../tags/jquery.html">jQuery</a>
             / 
            <a href="../../../tags/zendframework.html">ZendFramework</a>
            
            
        </div>
        

        <div class="metadata">
        <p>
            <small>
                Posted on December 01, 2008
                
            </small>
        </p>
    </div>
        

        
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>Â© Copyright 2008-2017, Benjamin Eberlei.</small>

						<script type="text/javascript">    var disqus_shortname = "whitewashing";    disqus_count();</script>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-32146757-1', 'auto');
          ga('send', 'pageview');
        </script>

    </body>
</html>
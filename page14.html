<!DOCTYPE html><!--[if lt IE 7]>      <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:og="http://ogp.me/ns#"
    xmlns:fb="https://www.facebook.com/2008/fbml" class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="description" content="Blog of Benjamin Eberlei, covering a wide range of programming, bootstrapping and entrepreneurial topics">
        <meta name="viewport" content="width=device-width">
        <meta name="google-site-verification" content="mycr8JCbLYq9QcOyh4Ub1esAdN-awH9ut6nyTKUTgE4">
        <title>Page 14 &mdash; beberlei.de</title>
            <link rel="stylesheet" href="/_static/pygments.css" type="text/css" />
            <link rel="stylesheet" href="/_static/css/bootstrap.min.css" type="text/css" />
            <link rel="stylesheet" href="/_static/blog.css" type="text/css" />
            <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" />
        <link rel="shortcut icon" href="_static/tinkerer.ico" /><!-- Load modernizr and JQuery -->
        <script src="_static/vendor/modernizr-2.6.2.min.js"></script>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script>window.jQuery || document.write('<script src="_static/vendor/jquery-1.8.2.min.js"><\/script>')</script>
        <script src="_static/plugins.js"></script>
        <script src="_static/main.js"></script>
        <link rel="search" title="Search" href="search.html" /><link rel="next" title="Older" href="page15.html" /><link rel="prev" title="Newer" href="page13.html" /><link rel="alternate" type="application/rss+xml" title="RSS" href="rss.html" /><script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.7.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        SOURCELINK_SUFFIX: '.txt',
        HAS_SOURCE:  true
      };
    </script><script type="text/javascript" src="_static/underscore.js"></script><script type="text/javascript" src="_static/doctools.js"></script><script type="text/javascript" src="_static/language_data.js"></script></head>
    <body role="document">
        <!--[if lt IE 7]>
            <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
        <![endif]-->

      <div id="container"><nav class="navbar navbar-dark">
		  <div class="container">
			  <div class="navbar-header">
				  <a class="navbar-brand" href="https://beberlei.de">Benjamin Eberlei</a>
			  </div>

			  <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				  <ul class="nav navbar-nav navbar-right">
						<li><a href="index.html">Home</a></li>
						<li><a href="pages/about.html">About</a></li>
						<li><a href="pages/imprint.html">Imprint</a></li>
						<li><a href="/archive.html">Archive</a></li>
					  <li><a href="/rss.xml">RSS</a></li>
				  </ul>
			  </div>
		  </div>
		</nav><div class="main-container" role="main"><div class="container">
				<div class="row">
					<div class="col-md-8 col-md-offset-2 col-sm-12"><article role="article">
							<div class="section">
            <h1><a href="2009/02/08/unittest-and-metrics-aggregator-tool-for-php.html">Unittest and Metrics Aggregator Tool for PHP</a></h1>
<p>Both <a class="reference external" href="http://www.phpunit.de">PHPUnit</a> and
<a class="reference external" href="http:/www.pdepend.org">PDepend</a> offer export functionality in XML or
in a Test-database that is not quite readable for any user from the
start. Over the last month I have gradually written <a class="reference external" href="http://wiki.github.com/beberlei/puma">a nice webbased
tool</a>, that aggregates this data
and (todo in the future) relates them to help me with my open source
projects.</p>
<p>PHPUnit can be used with a <strong>–test-db-dsn</strong> command, which saves all
information about tests into a Database and PDepend has a strong Package
centric source parser for all sorts of project metrics.</p>
<p>What I needed for my <a class="reference external" href="http://framework.zend.com">Zend Framework</a>
related work (and other projects) was a tool that does a run of the
complete test-suite for me and saves the information, so that I can see
where problems occur (and if they are due to my changes or other
peoples). Since PHPUnit will stopped calculating additional metrics, I
have also integrated the fabulous PDepend Tool into this aggregator. It
shows me, what classes and functions need refactoring due to complexity
issues and draws some nice graphs that summarize all sorts of project
related information on a per package basis.</p>
<p>You can <a class="reference external" href="http://wiki.github.com/beberlei/puma">download or clone the an alpha version at
Github</a>. Its written with
<a class="reference external" href="http://www.ezcomponents.org">ezcMvcTools</a>, so you need this to work
too. A list of <a class="reference external" href="http://wiki.github.com/beberlei/puma">some screenshots is at the Github Wiki
page</a>.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/puma.html">PUMA</a>
                 / 
                <a href="tags/testing.html">Testing</a>
                 / 
                <a href="tags/metrics.html">Metrics</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on February 08, 2009
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2009/02/13/update-on-unittest-and-metrics-tool.html">Update on Unittest and Metrics Tool</a></h1>
<p>Some days ago i posted about the PHP Unittest and Metrics Aggregator tool that
i have written on (and which I have dubbed PUMA). Discussing it with people I
came to the conclusion that the approach using <a class="reference external" href="http://ezcomponents.org">ezcMvcTools</a> is quite problematic that it forces to use this
application, although the reporting and the application are quite separate.
This is not against ezcMvcTools: I love it, its just the wrong type of support.</p>
<p>I began to split up the aggregator into some sort of importing-exporting
tool. You can specify library-, test- and output-directory of your
application and it will use the tools at hand
(<a class="reference external" href="http://www.phpunit.de">PHPUnit</a>, <a class="reference external" href="http://www.pdepend.org">PDepend</a>
and CodeSniffer currently) to generate their XML formatted reports. It
then parses those XML outputted files and combines their result to give
a consistent view on your application.</p>
<p>The Import-To-Output generator uses a three-step approach. An importer
emits signals to report observers, which will then hand over their
collected data to specific html pages that are then generated to the
disc. This is a very flexible approach that allows anyone to extend and
re-use the tool to generate project metrics, unittest overview and other
interesting details on your application.</p>
<p>Have a look at the tool on Github and play with it.  I would really like to
hear your thoughts.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/puma.html">PUMA</a>
                 / 
                <a href="tags/testing.html">Testing</a>
                 / 
                <a href="tags/metrics.html">Metrics</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on February 13, 2009
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2009/05/01/explicit-code-requires-no-comments-only-bad-code-does.html">Explicit Code requires no comments - Only bad code does</a></h1>
<p>Following the recent discussion on commenting source code by <a class="reference external" href="http://www.brandonsavage.net/on-code-commenting-and-technical-debt/">Brandon
Savage</a>
and <a class="reference external" href="http://mtabini.blogspot.com/2009/04/myth-of-myth-of-self-commenting-code.html">Marco
Tabini</a>,
I wanted to add upon Marcos code example to show that it not even needs
any inline comments and can be greatly enhanced in readability with
taking 2-5 minutes of time and refactoring the code. The original code
sample was:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>function __construct(array $pathInfo) {
    $section = $pathInfo[0];
    $file = $pathInfo[1];

    // Assume that the location of this file is inside the main trunk, and that pathInfo has already been filtered.

    $path = dirname(__FILE__) . '/../../' . $section . '/xml/static/' . $file . '.xml';

    if (!file_exists($path)) {
        Controller::singleton()-&gt;doError(404);
    }

    parent::__construct('main/xsl/template.xsl', $path);
}
</pre></div>
</div>
</div></blockquote>
<p>This sample is somehow related to the response and view rendering of an
application and its pretty understandable. For me there are some squirks
though that would make me have to scroll to other classes to see how
they interact. For example the path information falls from heaven. Why
is it an array of 2 values and are these sections set the same all the
time? And what exactly happens when the front controller does the 404
error? Is there a die() or exit in the <strong>doError()</strong></p>
<p>The Agile movement postulates the phase of refactoring for a finished
piece of code. Rebuilding the hacked solutions that did it to make them
more understandable. I applied this to Marcos code snippet. The
refactoring produces about double the code, but its done entirely by
using NetBeans nice Rename variable and copy paste on extracting
methods, which takes not more than 5 minutes.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>class StaticXmlXsltRendererImpl extends AbstractXsltView
{
    function render(array $filteredPathInfo) {
        $templateValuesXmlPath = $this-&gt;getTemplateValuesXmlFile($filteredPathInfo);

        if(!$this-&gt;templateExists($templateValuesXmlPath)) {
            Controller::singleton()-&gt;doError(404);
        } else {
            parent::render('main/xsl/template.xsl', $templateValuesXmlPath);
        }
    }

    private function getTemplateValuesXmlFile($filteredPathInfo) {
        $section = $this-&gt;getSection($filteredPathInfo);
        $file = $this-&gt;getFile($filteredPathInfo);

        // Assume that the location of this file is inside the main trunk
        return dirname(__FILE__) . '/../../' . $section . '/xml/static/' . $file . '.xml';
    }


    private function getSection($pathInfo) {
        return $pathInfo[0];
    }

    private function getFile($pathInfo) {
        return $pathInfo[1];
    }

    private function templateExists($path) {
        return file_exists($path);
    }
}
</pre></div>
</div>
</div></blockquote>
<p>In this code snippet the class name, variable names and methods clearly
communicate what is done, which wasn’t the case in the previous example.
The only change for the clients is the change of using the constructor
to using the <strong>render()</strong> method, which communicates the intend more.
Also the render method now clearly communicates that either the error or
the parent rendering is executed and leaves no doubt about it.</p>
<p>The <strong>getTemplateValuesXmlFile()</strong> method still uses the comment to show
the assumption about relative paths, but this is only the case because
application configuration is made implicit into the code. This has to be
extracted to be an explicit configuration constant and the comment can
go.</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>private function getTemplateValuesXmlFile($filteredPathInfo) {
    $section = $this-&gt;getSection($filteredPathInfo);
    $file = $this-&gt;getFile($filteredPathInfo);

    return APPLICATION_ROOT . '/' . $section . '/xml/static/' . $file . '.xml';
}
</pre></div>
</div>
<p>In my opinion commenting code is necessary only for non-refactored
code that has been hacked into existence and is hard to understand.
Either the programmer has to get it done and has no chance to
clearly communicate the intend. Or what is even worse the to be
changed legacy code is hard to understand but you can’t take the
chances to refactor it because its also already in production and
has no tests. Now from the second point it is obvious that upon ugly
code you put only more and more ugly code to fix the problems. This
is what leads to the legacy maintenance problems that pretty much
every programmer faces. And then commenting comes into play: You
have to add a new feature X and it has to be done fast. You don’t
really understand the code or how it works together but you know you
can put the new code for the feature into existence but its really
unintuitive. So you begin to comment it excessively, because its the
only way to clearly show its intend.</p>
<p>There are two mindestting factors that help to write code that is
understandable without having to excessively comment it:</p>
<ul class="simple">
<li>From the beginning, do not write code for the computer but for
developers. Changing this attitude really helps to write
understandable code like the one above.</li>
<li>Only leave code better than it was before, never worse.</li>
</ul>
<p>There are five technical practices that - when followed - allow to
write clearly communicating code from the beginning:</p>
<ol class="arabic simple">
<li>Giving classes, variables and methods good names. This is a
no-brainer but few people seem to follow it anyways.</li>
<li>Following the object-oriented <strong>Single Responsibility Principle</strong>
by never giving a class more than one responsibility. Macros
example seems to follow this one.</li>
<li>Methods should never switch in the level of detail. Micro-work at
the datastructure level should never be mixed with macro level
delegation to executing large chunks of code. Macros code
violates this by mixing the path building micro-level work with
the macro-level work of rendering the XSLT template. The path
building code can be hidden behind a method to communicate intend
more clearly.</li>
<li>Exchange if conditions with private methods that explain the
condition being checked for. In Marcos example this is not really
necessary, because file_exists already is quite a good
description to the condition. But in cases of logical
combinations of conditions the method extracting is a superior
way to explain the conditions intend without having to write a
comment.</li>
<li><strong>Seperate Query and Command</strong>: A method never should do a query
which returns the state of an object and a command which executes
a set of rules on the state.</li>
</ol>
<p>These practices sum up to one guideline: Make code explicit. This
obviously requires less commenting since a comment of explicit code
would be duplication and duplication is bad. What if you have a
project that does not follow this guidelines? Then of course
comments should be used to explain code, but in the long run this
should be refactored to self-explaining code. Additionally every new
feature should be programmed explicitly to follow the “leave code
better than before” principle.</p>
<p>In my opinion two refactoring tools are missing that would greatly
help PHP programmers write nice to read code: Extract method and
Replace magic value with constant. Can someone integrate them into
NetBeans please?</p>
<p><strong>Update:</strong> Fixed a creepy copy-paste code bug, thanks to azeroth
for pointing out. Moved methods around a bit to be more reading
friendly.</p>
</div></blockquote>


            
            <div class="tags">
                More about: 
                <a href="tags/codequality.html">CodeQuality</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on May 01, 2009
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2009/06/16/using-a-dependency-injection-container-with-zend-application.html">Using a Dependency Injection Container with Zend_Application</a></h1>
<p>Much has been written on Dependency Injection lately, mostly by Padraic
Brady
(<a class="reference external" href="http://blog.astrumfutura.com/archives/394-The-Case-For-Dependency-Injection-Part-1.html">1</a>,
<a class="reference external" href="http://blog.astrumfutura.com/archives/395-The-Case-For-Dependency-Injection-Part-2.html">2</a>)
and Fabien Potencier
(<a class="reference external" href="http://fabien.potencier.org/article/11/what-is-dependency-injection">1</a>,
<a class="reference external" href="http://fabien.potencier.org/article/12/do-you-need-a-dependency-injection-container">2</a>,
<a class="reference external" href="http://fabien.potencier.org/article/13/introduction-to-the-symfony-service-container">3</a>,
<a class="reference external" href="http://fabien.potencier.org/article/14/symfony-service-container-using-a-builder-to-create-services">4</a>,
<a class="reference external" href="http://github.com/fabpot/Pimple/tree/master">5</a>). My subjective
feeling tells me there are now more PHP DI containers out there than CMS
or ORMs implemented in PHP, including two written by myself (an
<a class="reference external" href="http://www.beberlei.de/sphicy/">overengineered</a> and <a class="reference external" href="http://github.com/beberlei/yadif/tree/master">a useful
one</a>). Its an awesome
pattern if used on a larger scale and can (re-) wire a complex business
application according to a clients needs without having to change much
of the domain code. It aims at a complete separation of object
instantiation and dependency tracking from the business logic.</p>
<p>Beginning with version 1.8 Zend Framework is able to integrate any of
these DI containers into its <strong>Zend_Application</strong> component easily. The
Application component initializes a set of common resources and pushes
them into the MVC stack as additional Front Controller parameters.
Technically a <strong>Zend_Registry</strong> instance holds all these resources with
their respective resource names as keys. The resources are accessible
inside the Front Controller and the Action Controller classes. Assume
the resource ‘Db’ is initialized in your application, you can access it
with:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>$front = Zend_Controller_Front::getInstance();
$container = $front-&gt;getParam('bootstrap')-&gt;getContainer();
$db = $container-&gt;db;

// or:
class FooController extends Zend_Controller_Action {
    public function barAction()
    {
        $container = $this-&gt;getInvokeArg('bootstrap')-&gt;getContainer();
        $db = $container-&gt;db;
    }
}
</pre></div>
</div>
</div></blockquote>
<p>This is pretty much dependency injection already, but the default
registry approach suffers from two serious problem: New instances can
only be added to the Container by implementing new Zend_Application
resources and these instances cannot be lazy loaded. All resources used
by Zend_Application are always loaded on every request. But the
application container implementation was developed with Dependency
Injection in mind and is not tied to the use of Zend_Registry. Only
three magic methods are required by any container that wants to be
Zend_Application compliant: __get(), __set() and __isset(). Each
instantiated resource is pushed via __set() into the container. If
required by another resource, __isset() is used to check whether a
resource with the given name exists inside the container and __get()
is used to retrieve the instances from the container.</p>
<p>Some month ago I extended
<a class="reference external" href="http://github.com/beberlei/yadif/tree/master">Yadif</a>, a lightweight
PicoContainer-like DI container for PHP written by Thomas McKelvey, with
several features that make it a very powerful DI container in my
opinion. It has a detailed documentation and examples on the GitHub Page
if you want to check it out. I extended Yadif to be Zend_Application
compliant in a way that the application-wide Zend_Application resources
can be used as dependencies for objects that are lazy-loaded from the
container. Skipping the tech-talk, here is an example. First we have to
replace the default Container with Yadif:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>$objects = new Zend_Config_Xml(APPLICATION_PATH."/config/objects.xml");
$container = new Yadif_Container($objects);

$application = new Zend_Application(
    APPLICATION_ENV,
    APPLICATION_PATH . '/config/application.xml'
);
// Set Yadif as Container
$application-&gt;getBootstrap()-&gt;setContainer($container);
$application-&gt;bootstrap()
            -&gt;run();
</pre></div>
</div>
</div></blockquote>
<p>Assume you run Zend_Application with a “Db” and a “Cache” resource.
These resources are loaded on every request. The objects configured in
Yadif however are not instantiated until they are requested for the
first time from the container. We can merge these two worlds and make
use of the Application resources inside the Yadif Configuration
“objects.xml”, which looks like:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>&lt;?xml version="1.0" ?&gt;
&lt;objects&gt;
    &lt;myModel&gt;
        &lt;class&gt;MyModel&lt;/class&gt;
        &lt;arguments arg1="db" arg2="cache" /&gt;
    &lt;/myModel&gt;
&lt;/objects&gt;
</pre></div>
</div>
<p>Instantiating a <strong>myModel</strong> class inside the Action Controller uses
the the Database and Cache resources as constructor arguments:</p>
<blockquote>
<div><div class="highlight-default notranslate"><div class="highlight"><pre><span/>class FooController extends Zend_Controller_Action {
    public function barAction()
    {
        $container = $this-&gt;getInvokeArg('bootstrap')-&gt;getContainer();
        $myModel = $container-&gt;myModel;
    }
}
</pre></div>
</div>
</div></blockquote>
<p>Given the possibilites by the Yadif_Container you are now empowered
to use Dependency Injection for all your application objects and
make use of Zend_Applications resource system. Furthermore any
other dependency injection container, simple or complex, can also be
integrated easily.</p>
</div></blockquote>


            
            <div class="tags">
                More about: 
                <a href="tags/zendframework.html">ZendFramework</a>
                 / 
                <a href="tags/dependencyinjection.html">DependencyInjection</a>
                 / 
                <a href="tags/yadiflibrary.html">YadifLibrary</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on June 16, 2009
                
            </small>
        </p>
    </div>
        </div><div class="separator post_separator"></div><div class="section">
            <h1><a href="2009/11/14/netbeans-php-codesniffer-plugin-now-with-options-dialog.html">Netbeans PHP CodeSniffer Plugin: Now with Options Dialog</a></h1>
<p>Just two days before the <a class="reference external" href="http://www.phpconference.de">International PHP Conference
09</a> will start I got an email from
<a class="reference external" href="http://github.com/alexandrehaguiar">alexandrehaguiar</a> that he forked
my Netbeans PHP CodeSniffer plugin and added the long awaited Options
screen. This is just awesome! This way I don’t have to ask the Netbeans
guys at IPC all the questions about how to implement it. I merged the
changes back into my branch and released a new version which also fixed
another small bug. For me it works with both Netbeans 6.7.1 and 6.8
Beta. I want to thank alexandre very much for this awesome contribution.</p>
<p>What you can do now is chose the Coding Standard you want to use in an
Options Dialog under the “Miscellaneous” button. You can choose from a
list of pre-defined standards, or even enter your own if you use one.
Additionally you can disable that warning are shown, so that with any
given coding standard you only see the errors.</p>
<p><a class="reference external" href="http://cloud.github.com/downloads/beberlei/netbeans-php-enhancements/phpcsoptions.png">|image0|</a></p>
<p>You can download the new version from the <a class="reference external" href="http://github.com/beberlei/netbeans-php-enhancements/downloads/">Github Project Downloads
page</a>.</p>


            
            <div class="tags">
                More about: 
                <a href="tags/netbeans.html">Netbeans</a>
                
                
            </div>
            

            <div class="metadata">
        <p>
            <small>
                Posted on November 14, 2009
                 by beberlei <kontakt@beberlei.de>
            </small>
        </p>
    </div>
        </div><div class="archive_link">
        <a href="archive.html">Archive</a>
    </div></article></div> <!-- #main -->
				</div>
			</div></div> <!-- #main-container -->

        <div class="footer-container" role="contentinfo">
			<div class="container">
				<div class="col-md-8 col-md-offset-2">
					<div class="footer">
						<small>© Copyright 2008-2018, Benjamin Eberlei.</small>
					</div>
				</div>
			</div>
        </div> <!-- footer-container -->
      </div> <!--! end of #container --><!--[if lt IE 7 ]>
          <script src="//ajax.googleapis.com/ajax/libs/chrome-frame/1.0.3/CFInstall.min.js"></script>
          <script>window.attachEvent('onload',function(){CFInstall.check({mode:'overlay'})})</script>
        <![endif]-->

        <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-32146757-1', 'auto');
          ga('send', 'pageview');
        </script>

    </body>
</html>